<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.1 from org.apache.maven.plugins:maven-pmd-plugin:3.20.0:cpd at 2023-04-16

 | Rendered using Apache Maven Default Skin
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.1" />
    <title>Mage Framework &#x2013; CPD Results</title>
    <link rel="stylesheet" href="./css/maven-base.css" />
    <link rel="stylesheet" href="./css/maven-theme.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
  </head>
  <body class="composite">
    <div id="banner">
<div id="bannerLeft">Mage Framework
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2023-04-16</span>
          &#xA0;| <span id="projectVersion">Version: 1.4.50</span>
      </div>
      <div class="xright"><a href="${project.url}" title="Mage Framework">Mage Framework</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Parent Project</h5>
    <ul>
     <li class="none"><a href="../index.html" title="Mage Root">Mage Root</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
     <li class="expanded"><a href="project-reports.html" title="Project Reports">Project Reports</a>
      <ul>
       <li class="none"><strong>CPD</strong></li>
       <li class="none"><a href="pmd.html" title="PMD">PMD</a></li>
       <li class="none"><a href="findbugs.html" title="FindBugs">FindBugs</a></li>
       <li class="none"><a href="checkstyle.html" title="Checkstyle">Checkstyle</a></li>
       <li class="none"><a href="xref/index.html" title="Source Xref">Source Xref</a></li>
       <li class="none"><a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a></li>
      </ul></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<section>
<h2><a name="CPD_Results"></a>CPD Results</h2>
<p>The following document contains the results of PMD's  <a class="externalLink" href="https://pmd.github.io/latest/pmd_userdocs_cpd.html">CPD</a> 6.53.0.</p></section><section>
<h2><a name="Duplications"></a>Duplications</h2>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L48">48</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetCreatureOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetCreatureOrPlayer.html#L48">48</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>public TargetAnyTarget(final TargetAnyTarget target) {
        super(target);
        this.filter = target.filter.copy();
    }

    @Override
    public Filter getFilter() {
        return this.filter;
    }

    @Override
    public boolean canTarget(UUID id, Game game) {
        Permanent permanent = game.getPermanent(id);
        if (permanent != null) {
            return filter.match(permanent, game);
        }
        Player player = game.getPlayer(id);
        return filter.match(player, game);
    }

    @Override
    public boolean canTarget(UUID id, Ability source, Game game) {
        return canTarget(source.getControllerId(), id, source, game);
    }

    @Override
    public boolean canTarget(UUID controllerId, UUID id, Ability source, Game game) {
        Permanent permanent = game.getPermanent(id);
        Player player = game.getPlayer(id);

        if (source != null) {
            MageObject targetSource = game.getObject(source);
            if (permanent != null) {
                return permanent.canBeTargetedBy(targetSource, source.getControllerId(), game) &amp;&amp; filter.match(permanent, source.getControllerId(), source, game);
            }
            if (player != null) {
                return player.canBeTargetedBy(targetSource, source.getControllerId(), game) &amp;&amp; filter.match(player, game);
            }
        }

        if (permanent != null) {
            return filter.match(permanent, game);
        }
        return filter.match(player, game);
    }

    /**
     * Checks if there are enough {@link Permanent} or {@link Player} that can
     * be chosen. Should only be used for Ability targets since this checks for
     * protection, shroud etc.
     *
     * @param sourceControllerId - controller of the target event source
     * @param source
     * @param game
     * @return - true if enough valid {@link Permanent} or {@link Player} exist
     */
    @Override
    public boolean canChoose(UUID sourceControllerId, Ability source, Game game) {
        int count = 0;

        MageObject targetSource = game.getObject(source);
        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {
            Player player = game.getPlayer(playerId);
            if (player != null &amp;&amp; player.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(player, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }

        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\GameState.java</td>
<td><a href="./xref/mage/game/GameState.html#L353">353</a></td></tr>
<tr class="a">
<td>mage\game\GameState.java</td>
<td><a href="./xref/mage/game/GameState.html#L406">406</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (useHidden) {
                sb.append(player.getHand().getValue(game));
            } else {
                sb.append(player.getHand().size());
            }
            sb.append(&quot;library&quot;).append(player.getLibrary().size());
            sb.append(&quot;graveyard&quot;);
            sb.append(player.getGraveyard().getValue(game));
        }

        sb.append(&quot;permanents&quot;);
        List&lt;String&gt; perms = new ArrayList&lt;&gt;();
        for (Permanent permanent : battlefield.getAllPermanents()) {
            perms.add(permanent.getValue(this));
        }
        Collections.sort(perms);
        sb.append(perms);

        sb.append(&quot;spells&quot;);
        for (StackObject spell : stack) {
            sb.append(spell.getControllerId()).append(spell.getName());
            sb.append(spell.getStackAbility().toString());
            for (UUID modeId : spell.getStackAbility().getModes().getSelectedModes()) {
                Mode mode = spell.getStackAbility().getModes().get(modeId);
                if (!mode.getTargets().isEmpty()) {
                    sb.append(&quot;targets&quot;);
                    for (Target target : mode.getTargets()) {
                        sb.append(target.getTargets());
                    }
                }
            }
        }

        for (ExileZone zone : exile.getExileZones()) {
            sb.append(&quot;exile&quot;).append(zone.getName()).append(zone.getValue(game));
        }

        sb.append(&quot;combat&quot;);
        for (CombatGroup group : combat.getGroups()) {
            sb.append(group.getDefenderId()).append(group.getAttackers()).append(group.getBlockers());
        }

        return sb.toString();
    }

    public String getValue(Game game, UUID playerId) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\GainAbilityControlledSpellsEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainAbilityControlledSpellsEffect.html#L37">37</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\GainAbilitySpellsEffect.java</td>
<td><a href="./xref/mage/abilities/effects/GainAbilitySpellsEffect.html#L32">32</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return new GainAbilityControlledSpellsEffect(this);
    }

    @Override
    public boolean apply(Game game, Ability source) {
        Player player = game.getPlayer(source.getControllerId());
        Permanent permanent = game.getPermanent(source.getSourceId());
        if (player == null || permanent == null) {
            return false;
        }

        for (Card card : game.getExile().getAllCards(game)) {
            if (card.isOwnedBy(source.getControllerId())
                    &amp;&amp; filter.match(card, game)) {
                game.getState().addOtherAbility(card, ability);
            }
        }
        for (Card card : player.getLibrary().getCards(game)) {
            if (filter.match(card, game)) {
                game.getState().addOtherAbility(card, ability);
            }
        }
        for (Card card : player.getHand().getCards(game)) {
            if (filter.match(card, game)) {
                game.getState().addOtherAbility(card, ability);
            }
        }
        for (Card card : player.getGraveyard().getCards(game)) {
            if (filter.match(card, game)) {
                game.getState().addOtherAbility(card, ability);
            }
        }

        // workaround to gain cost reduction abilities to commanders before cast (make it playable)
        game.getCommanderCardsFromCommandZone(player, CommanderCardType.ANY)
                .stream()
                .filter(card -&gt; filter.match(card, game))
                .forEach(card -&gt; {
                    game.getState().addOtherAbility(card, ability);
                });

        for (StackObject stackObject : game.getStack()) {
            // only spells cast, so no copies of spells
            if ((stackObject instanceof Spell)</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\cards\decks\exporter\XmageDeckExporter.java</td>
<td><a href="./xref/mage/cards/decks/exporter/XmageDeckExporter.html#L61">61</a></td></tr>
<tr class="a">
<td>mage\cards\decks\exporter\XmageInfoDeckExporter.java</td>
<td><a href="./xref/mage/cards/decks/exporter/XmageInfoDeckExporter.html#L78">78</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

        // layout print
        if (deck.getCardLayout() != null) {
            out.print(&quot;LAYOUT MAIN:&quot;);
            writeCardLayout(out, deck.getCardLayout());
            out.println(&quot;&quot;);
            out.print(&quot;LAYOUT SIDEBOARD:&quot;);
            writeCardLayout(out, deck.getSideboardLayout());
            out.println(&quot;&quot;);
        }
    }

    private static void writeCardLayout(PrintWriter out, DeckCardLayout layout) {
        if (layout == null) {
            return;
        }
        List&lt;List&lt;List&lt;DeckCardInfo&gt;&gt;&gt; cardGrid = layout.getCards();
        int height = cardGrid.size();
        int width = (height &gt; 0) ? cardGrid.get(0).size() : 0;
        out.print(&quot;(&quot; + height + ',' + width + ')');
        out.print(layout.getSettings());
        out.print(&quot;|&quot;);
        for (List&lt;List&lt;DeckCardInfo&gt;&gt; row : cardGrid) {
            for (List&lt;DeckCardInfo&gt; stack : row) {
                out.print(&quot;(&quot;);
                for (int i = 0; i &lt; stack.size(); ++i) {
                    DeckCardInfo info = stack.get(i);
                    out.printf(&quot;[%s:%s]&quot;, info.getSetCode(), info.getCardNum());
                    if (i != stack.size() - 1) {
                        out.print(&quot;,&quot;);
                    }
                }
                out.print(&quot;)&quot;);
            }
        }
    }

    @Override
    public FileFilter getFileFilter() {
        return fileFilter;
    }

    @Override
    public String getDescription() {
        return description;
    }

    @Override
    public String getDefaultFileExt() {
        return ext;
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\keyword\FlashbackAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/FlashbackAbility.html#L82">82</a></td></tr>
<tr class="a">
<td>mage\abilities\keyword\ForetellAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/ForetellAbility.html#L367">367</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return ((ModalDoubleFacesCard) card).getRightHalfCard().getSpellAbility().canActivate(playerId, game);
                    }
                }
                return card.getSpellAbility().canActivate(playerId, game);
            }
        }
        return ActivationStatus.getFalse();
    }

    @Override
    public SpellAbility getSpellAbilityToResolve(Game game) {
        Card card = game.getCard(getSourceId());
        if (card != null) {
            if (spellAbilityToResolve == null) {
                SpellAbility spellAbilityCopy = null;
                if (card instanceof SplitCard) {
                    if (((SplitCard) card).getLeftHalfCard().getName().equals(abilityName)) {
                        spellAbilityCopy = ((SplitCard) card).getLeftHalfCard().getSpellAbility().copy();
                    } else if (((SplitCard) card).getRightHalfCard().getName().equals(abilityName)) {
                        spellAbilityCopy = ((SplitCard) card).getRightHalfCard().getSpellAbility().copy();
                    }
                } else if (card instanceof ModalDoubleFacesCard) {
                    if (((ModalDoubleFacesCard) card).getLeftHalfCard().getName().equals(abilityName)) {
                        spellAbilityCopy = ((ModalDoubleFacesCard) card).getLeftHalfCard().getSpellAbility().copy();
                    } else if (((ModalDoubleFacesCard) card).getRightHalfCard().getName().equals(abilityName)) {
                        spellAbilityCopy = ((ModalDoubleFacesCard) card).getRightHalfCard().getSpellAbility().copy();
                    }
                } else {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\cards\decks\exporter\XmageDeckExporter.java</td>
<td><a href="./xref/mage/cards/decks/exporter/XmageDeckExporter.html#L20">20</a></td></tr>
<tr class="a">
<td>mage\cards\decks\exporter\XmageInfoDeckExporter.java</td>
<td><a href="./xref/mage/cards/decks/exporter/XmageInfoDeckExporter.html#L21">21</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>private final FileFilter fileFilter = new DeckFileFilter(ext, description);

    @Override
    public void writeDeck(PrintWriter out, DeckCardLists deck) {
        List&lt;DeckCardInfo&gt; deckMain = new ArrayList&lt;&gt;();
        List&lt;DeckCardInfo&gt; deckSideboard = new ArrayList&lt;&gt;();
        Map&lt;String, Integer&gt; amount = new HashMap&lt;&gt;();

        // info
        if (deck.getName() != null &amp;&amp; !deck.getName().isEmpty()) {
            out.println(&quot;NAME:&quot; + deck.getName());
        }
        if (deck.getAuthor() != null &amp;&amp; !deck.getAuthor().isEmpty()) {
            out.println(&quot;AUTHOR:&quot; + deck.getAuthor());
        }

        // main
        for (DeckCardInfo card : deck.getCards()) {
            String code = &quot;M@&quot; + card.getCardKey();
            int curAmount = amount.getOrDefault(code, 0);
            if (curAmount == 0) {
                deckMain.add(card);
            }
            amount.put(code, curAmount + card.getQuantity());
        }
        // sideboard
        for (DeckCardInfo card : deck.getSideboard()) {
            String code = &quot;S@&quot; + card.getCardKey();
            int curAmount = amount.getOrDefault(code, 0);
            if (curAmount == 0) {
                deckSideboard.add(card);
            }
            amount.put(code, curAmount + card.getQuantity());
        }

        // cards print
        for (DeckCardInfo card : deckMain) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\Dungeon.java</td>
<td><a href="./xref/mage/game/command/Dungeon.html#L239">239</a></td></tr>
<tr class="a">
<td>mage\game\command\Emblem.java</td>
<td><a href="./xref/mage/game/command/Emblem.html#L155">155</a></td></tr>
<tr class="b">
<td>mage\game\command\Plane.java</td>
<td><a href="./xref/mage/game/command/Plane.html#L154">154</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>}

    @Override
    public List&lt;CardType&gt; getCardType(Game game) {
        return emptyList;
    }

    @Override
    public SubTypes getSubtype() {
        return new SubTypes();
    }

    @Override
    public SubTypes getSubtype(Game game) {
        return new SubTypes();
    }

    @Override
    public boolean hasSubtype(SubType subtype, Game game) {
        return false;
    }

    @Override
    public EnumSet&lt;SuperType&gt; getSuperType() {
        return EnumSet.noneOf(SuperType.class);
    }

    @Override
    public Abilities&lt;Ability&gt; getAbilities() {
        return abilites;
    }

    @Override
    public boolean hasAbility(Ability ability, Game game) {
        return getAbilities().contains(ability);
    }

    @Override
    public ObjectColor getColor() {
        return emptyColor;
    }

    @Override
    public ObjectColor getColor(Game game) {
        return emptyColor;
    }

    @Override
    public ObjectColor getFrameColor(Game game) {
        return emptyColor;
    }

    @Override
    public ManaCosts&lt;ManaCost&gt; getManaCost() {
        return emptyCost;
    }

    @Override
    public int getManaValue() {
        return 0;
    }

    @Override
    public MageInt getPower() {
        return MageInt.EmptyMageInt;
    }

    @Override
    public MageInt getToughness() {
        return MageInt.EmptyMageInt;
    }

    @Override
    public int getStartingLoyalty() {
        return 0;
    }

    @Override
    public void setStartingLoyalty(int startingLoyalty) {
    }

    @Override
    public UUID getId() {
        return this.id;
    }

    @Override
    public Dungeon copy() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalRequirementEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalRequirementEffect.html#L51">51</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalRestrictionEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalRestrictionEffect.html#L50">50</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>this.otherwiseEffect = (RequirementEffect) effect.otherwiseEffect.copy();
        }
        this.condition = effect.condition;
        this.conditionState = effect.conditionState;
        this.baseCondition = effect.baseCondition;
        this.initDone = effect.initDone;
    }

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        if (baseCondition instanceof LockedInCondition) {
            condition = new FixedCondition(((LockedInCondition) baseCondition).getBaseCondition().apply(game, source));
        } else {
            condition = baseCondition;
        }
        effect.setTargetPointer(this.targetPointer);
        effect.init(source, game);
        if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            otherwiseEffect.init(source, game);
        }
        initDone = true;
    }

    @Override
    public boolean applies(Permanent permanent, Ability source, Game game) {
        if (!initDone) { // if simpleStaticAbility, init won't be called
            init(source, game);
        }
        conditionState = condition.apply(game, source);
        if (conditionState) {
            effect.setTargetPointer(this.targetPointer);
            return effect.applies(permanent, source, game);
        } else if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            return otherwiseEffect.applies(permanent, source, game);
        }
        if (!conditionState &amp;&amp; effect.getDuration() == Duration.OneUse) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalPreventionEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalPreventionEffect.html#L60">60</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalReplacementEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalReplacementEffect.html#L53">53</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return this.discarded || effect.isDiscarded() || (otherwiseEffect != null &amp;&amp; otherwiseEffect.isDiscarded());
    }

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        if (baseCondition instanceof LockedInCondition) {
            condition = new FixedCondition(((LockedInCondition) baseCondition).getBaseCondition().apply(game, source));
        } else {
            condition = baseCondition;
        }
        effect.setTargetPointer(this.targetPointer);
        effect.init(source, game);
        if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            otherwiseEffect.init(source, game);
        }
        initDone = true;
    }

    @Override
    public boolean replaceEvent(GameEvent event, Ability source, Game game) {
        if (conditionState) {
            effect.setTargetPointer(this.targetPointer);
            return effect.replaceEvent(event, source, game);
        } else if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            return otherwiseEffect.replaceEvent(event, source, game);
        }

        if (!conditionState &amp;&amp; effect.getDuration() == Duration.OneUse) {
            used = true;
        }
        if (!conditionState &amp;&amp; effect.getDuration() == Duration.Custom) {
            this.discard();
        }

        return false;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\keyword\FlashbackAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/FlashbackAbility.html#L67">67</a></td></tr>
<tr class="a">
<td>mage\abilities\keyword\ForetellAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/ForetellAbility.html#L348">348</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (card.getManaCost().isEmpty()) {
                    return ActivationStatus.getFalse();
                }
                // Flashback can never cast a split card by Fuse, because Fuse only works from hand
                // https://tappedout.net/mtg-questions/snapcaster-mage-and-flashback-on-a-fuse-card-one-or-both-halves-legal-targets/
                if (card instanceof SplitCard) {
                    if (((SplitCard) card).getLeftHalfCard().getName().equals(abilityName)) {
                        return ((SplitCard) card).getLeftHalfCard().getSpellAbility().canActivate(playerId, game);
                    } else if (((SplitCard) card).getRightHalfCard().getName().equals(abilityName)) {
                        return ((SplitCard) card).getRightHalfCard().getSpellAbility().canActivate(playerId, game);
                    }
                } else if (card instanceof ModalDoubleFacesCard) {
                    if (((ModalDoubleFacesCard) card).getLeftHalfCard().getName().equals(abilityName)) {
                        return ((ModalDoubleFacesCard) card).getLeftHalfCard().getSpellAbility().canActivate(playerId, game);
                    } else if (((ModalDoubleFacesCard) card).getRightHalfCard().getName().equals(abilityName)) {
                        return ((ModalDoubleFacesCard) card).getRightHalfCard().getSpellAbility().canActivate(playerId, game);
                    }
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\draft\RichManBoosterDraft.java</td>
<td><a href="./xref/mage/game/draft/RichManBoosterDraft.html#L52">52</a></td></tr>
<tr class="a">
<td>mage\game\draft\RichManCubeBoosterDraft.java</td>
<td><a href="./xref/mage/game/draft/RichManCubeBoosterDraft.html#L67">67</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>List&lt;Card&gt; nextBooster = sets.get((cardNum - 1) % sets.size()).createBooster();
                next.setBooster(nextBooster);
                if (Objects.equals(nextId, startId)) {
                    break;
                }
                nextId = table.getNext();
                next = players.get(nextId);
            }
        }
    }

    @Override
    protected boolean pickCards() {
        for (DraftPlayer player : players.values()) {
            if (cardNum &gt; 36) {
                return false;
            }
            player.setPicking();
            player.getPlayer().pickCard(player.getBooster(), player.getDeck(), this);
        }
        cardNum++;
        synchronized (this) {
            while (!donePicking()) {
                try {
                    this.wait();
                } catch (InterruptedException ex) {
                }
            }
        }
        return true;
    }

    @Override
    public void firePickCardEvent(UUID playerId) {
        DraftPlayer player = players.get(playerId);
        int cardNum = Math.min(36, this.cardNum);
        // richman uses custom times
        int time = (int) Math.ceil(customProfiTimes[cardNum - 1] * timing.getCustomTimeoutFactor());
        playerQueryEventSource.pickCard(playerId, &quot;Pick card&quot;, player.getBooster(), time);
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\common\BeginningOfPostCombatMainTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/BeginningOfPostCombatMainTriggeredAbility.html#L44">44</a></td></tr>
<tr class="a">
<td>mage\abilities\common\BeginningOfPreCombatMainTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/BeginningOfPreCombatMainTriggeredAbility.html#L49">49</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public boolean checkTrigger(GameEvent event, Game game) {
        switch (targetController) {
            case YOU:
                boolean yours = event.getPlayerId().equals(this.controllerId);
                if (yours &amp;&amp; setTargetPointer) {
                    if (getTargets().isEmpty()) {
                        for (Effect effect : this.getEffects()) {
                            effect.setTargetPointer(new FixedTarget(event.getPlayerId()));
                        }
                    }
                }
                return yours;
            case OPPONENT:
                if (game.getPlayer(this.controllerId).hasOpponent(event.getPlayerId(), game)) {
                    if (setTargetPointer) {
                        for (Effect effect : this.getEffects()) {
                            effect.setTargetPointer(new FixedTarget(event.getPlayerId()));
                        }
                    }
                    return true;
                }
                break;
            case ANY:
                if (setTargetPointer) {
                    for (Effect effect : this.getEffects()) {
                        effect.setTargetPointer(new FixedTarget(event.getPlayerId()));
                    }
                }
                return true;
        }
        return false;
    }

    private String generateTriggerPhrase() {
        switch (targetController) {
            case YOU:
                return &quot;At the beginning of your postcombat main phase, &quot; + generateZoneString();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\Dungeon.java</td>
<td><a href="./xref/mage/game/command/Dungeon.html#L188">188</a></td></tr>
<tr class="a">
<td>mage\game\command\Emblem.java</td>
<td><a href="./xref/mage/game/command/Emblem.html#L103">103</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return null;
    }

    @Override
    public UUID getControllerId() {
        return this.controllerId;
    }

    public void setControllerId(UUID controllerId) {
        this.controllerId = controllerId;
        this.abilites.setControllerId(controllerId);
    }

    @Override
    public void setCopy(boolean isCopy, MageObject copyFrom) {
        this.copy = isCopy;
        this.copyFrom = (copyFrom != null ? copyFrom.copy() : null);
    }

    @Override
    public boolean isCopy() {
        return this.copy;
    }

    @Override
    public MageObject getCopyFrom() {
        return this.copyFrom;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public String getIdName() {
        return getName() + &quot; [&quot; + getId().toString().substring(0, 3) + ']';
    }

    @Override
    public String getLogName() {
        return GameLog.getColoredObjectIdName(this);
    }

    @Override
    public String getImageName() {
        return this.name;
    }

    @Override
    public void setName(String name) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\combat\Combat.java</td>
<td><a href="./xref/mage/game/combat/Combat.html#L844">844</a></td></tr>
<tr class="a">
<td>mage\game\combat\Combat.java</td>
<td><a href="./xref/mage/game/combat/Combat.html#L941">941</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>boolean mayBlock = false;
                            for (UUID attackingCreatureId : getAttackers()) {
                                if (creature.canBlock(attackingCreatureId, game)) {
                                    Permanent attackingCreature = game.getPermanent(attackingCreatureId);
                                    if (attackingCreature != null) {
                                        // check if the attacker is already blocked by a max of blockers, so blocker can't block it also
                                        if (attackingCreature.getMaxBlockedBy() != 0) { // 0 = no restriction about the number of possible blockers
                                            int alreadyBlockingCreatures = 0;
                                            for (CombatGroup group : getGroups()) {
                                                if (group.getAttackers().contains(attackingCreatureId)) {
                                                    alreadyBlockingCreatures = group.getBlockers().size();
                                                    break;
                                                }
                                            }
                                            if (attackingCreature.getMaxBlockedBy() &lt;= alreadyBlockingCreatures) {
                                                continue; // Attacker can't be blocked by more blockers so check next attacker
                                            }
                                        }
                                        // check restrictions of the creature to block that prevent it can be blocked (note L_J: not sure what this refers to...)

                                        // check if enough possible blockers are available, if true, mayBlock can be set to true
                                        if (attackingCreature.getMinBlockedBy() &gt; 1) {
                                            int alreadyBlockingCreatures = 0;
                                            for (CombatGroup group : getGroups()) {
                                                if (group.getAttackers().contains(attackingCreatureId)) {
                                                    alreadyBlockingCreatures = group.getBlockers().size();
                                                    break;
                                                }
                                            }
                                            if (attackingCreature.getMinBlockedBy() &gt;= alreadyBlockingCreatures) {
                                                continue; // Attacker can't be blocked by the current blocker amount so check next attacker
                                            }
                                        } else {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\combat\Combat.java</td>
<td><a href="./xref/mage/game/combat/Combat.html#L818">818</a></td></tr>
<tr class="a">
<td>mage\game\combat\Combat.java</td>
<td><a href="./xref/mage/game/combat/Combat.html#L915">915</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (creature.getBlocking() &gt; 0) {
                    // get all requirement effects that apply to the creature (e.g. is able to block attacker)
                    for (Map.Entry&lt;RequirementEffect, Set&lt;Ability&gt;&gt; entry : game.getContinuousEffects().getApplicableRequirementEffects(creature, false, game).entrySet()) {
                        RequirementEffect effect = entry.getKey();
                        // get possible mustBeBlockedByAtLeastX blocker
                        for (Ability ability : entry.getValue()) {
                            UUID toBeBlockedCreature = effect.mustBlockAttackerIfElseUnblocked(ability, game);
                            if (toBeBlockedCreature != null) {
                                CombatGroup toBeBlockedGroup = findGroup(toBeBlockedCreature);
                                if (toBeBlockedGroup != null &amp;&amp; toBeBlockedGroup.getDefendingPlayerId().equals(creature.getControllerId())) {
                                    minNumberOfBlockersMap.put(toBeBlockedCreature, effect.getMinNumberOfBlockers());
                                    Set&lt;UUID&gt; potentialBlockers;
                                    if (mustBeBlockedByAtLeastX.containsKey(toBeBlockedCreature)) {
                                        potentialBlockers = mustBeBlockedByAtLeastX.get(toBeBlockedCreature);
                                    } else {
                                        potentialBlockers = new HashSet&lt;&gt;();
                                        mustBeBlockedByAtLeastX.put(toBeBlockedCreature, potentialBlockers);
                                    }
                                    potentialBlockers.add(creature.getId());
                                }
                            }
                        }
                        // check the mustBlockAllAttackers requirement for creatures already blocking (Blaze of Glory) -------------------------------
                        if (effect.mustBlockAllAttackers(game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\players\PlayerImpl.java</td>
<td><a href="./xref/mage/players/PlayerImpl.html#L3822">3822</a></td></tr>
<tr class="a">
<td>mage\players\PlayerImpl.java</td>
<td><a href="./xref/mage/players/PlayerImpl.html#L3931">3931</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>boolean isPlaySpell = (ability instanceof SpellAbility);
            boolean isPlayLand = (ability instanceof PlayLandAbility);

            // as original controller
            // play land restrictions
            if (isPlayLand &amp;&amp; game.getContinuousEffects().preventedByRuleModification(
                    GameEvent.getEvent(GameEvent.EventType.PLAY_LAND, ability.getSourceId(),
                            ability, this.getId()), ability, game, true)) {
                continue;
            }
            // cast spell restrictions 1
            GameEvent castEvent = GameEvent.getEvent(GameEvent.EventType.CAST_SPELL, ability.getId(), ability, this.getId());
            castEvent.setZone(fromZone);
            if (isPlaySpell &amp;&amp; game.getContinuousEffects().preventedByRuleModification(
                    castEvent, ability, game, true)) {
                continue;
            }
            // cast spell restrictions 2
            GameEvent castLateEvent = GameEvent.getEvent(GameEvent.EventType.CAST_SPELL_LATE,
                    ability.getId(), ability, this.getId());
            castLateEvent.setZone(fromZone);
            if (isPlaySpell &amp;&amp; game.getContinuousEffects().preventedByRuleModification(
                    castLateEvent, ability, game, true)) {
                continue;
            }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\mana\ActivatedManaAbilityImpl.java</td>
<td><a href="./xref/mage/abilities/mana/ActivatedManaAbilityImpl.html#L91">91</a></td></tr>
<tr class="a">
<td>mage\abilities\mana\TriggeredManaAbility.java</td>
<td><a href="./xref/mage/abilities/mana/TriggeredManaAbility.html#L63">63</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public List&lt;Mana&gt; getNetMana(Game game, Mana possibleManaInPool) {
        if (isPoolDependant()) {
            List&lt;Mana&gt; poolDependantNetMana = new ArrayList&lt;&gt;();
            for (Effect effect : getEffects()) {
                if (effect instanceof ManaEffect) {
                    List&lt;Mana&gt; effectNetMana = ((ManaEffect) effect).getNetMana(game, possibleManaInPool, this);
                    if (effectNetMana != null) {
                        poolDependantNetMana.addAll(effectNetMana);
                    }
                }
            }
            return poolDependantNetMana;            
        }
        return getNetMana(game);
    }

    @Override
    public Set&lt;ManaType&gt; getProducableManaTypes(Game game) {
        Set&lt;ManaType&gt; manaTypes = new HashSet&lt;&gt;();
        for (Effect effect : getEffects()) {
            if (effect instanceof ManaEffect) {
                manaTypes.addAll(((ManaEffect) effect).getProducableManaTypes(game, this));
            }
        }
        return manaTypes;
    }

    /**
     * Used to check if the ability itself defines mana types it can produce.
     *
     * @return
     */
    @Override
    public boolean definesMana(Game game) {
        return !getNetMana(game).isEmpty();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\ReturnToBattlefieldUnderOwnerControlTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/ReturnToBattlefieldUnderOwnerControlTargetEffect.html#L59">59</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\ReturnToBattlefieldUnderYourControlTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/ReturnToBattlefieldUnderYourControlTargetEffect.html#L62">62</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>cardsToBattlefield.add(targetId);
                    } else {
                        Card card = game.getCard(targetId);
                        if (card instanceof MeldCard) {
                            MeldCard meldCard = (MeldCard) card;
                            Card topCard = meldCard.getTopHalfCard();
                            Card bottomCard = meldCard.getBottomHalfCard();
                            if (topCard.getZoneChangeCounter(game) == meldCard.getTopLastZoneChangeCounter() &amp;&amp; game.getExile().containsId(topCard.getId(), game)) {
                                cardsToBattlefield.add(topCard);
                            }
                            if (bottomCard.getZoneChangeCounter(game) == meldCard.getBottomLastZoneChangeCounter() &amp;&amp; game.getExile().containsId(bottomCard.getId(), game)) {
                                cardsToBattlefield.add(bottomCard);
                            }
                        }
                    }
                }
            } else {
                cardsToBattlefield.addAll(getTargetPointer().getTargets(game, source));
            }
            if (!cardsToBattlefield.isEmpty()) {
                controller.moveCards(cardsToBattlefield.getCards(game), Zone.BATTLEFIELD, source, game, tapped, false, true, null);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\Emblem.java</td>
<td><a href="./xref/mage/game/command/Emblem.html#L243">243</a></td></tr>
<tr class="a">
<td>mage\game\command\Plane.java</td>
<td><a href="./xref/mage/game/command/Plane.html#L242">242</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return new Emblem(this);
    }

    public void setExpansionSetCodeForImage(String expansionSetCodeForImage) {
        this.expansionSetCodeForImage = expansionSetCodeForImage;
    }

    public String getExpansionSetCodeForImage() {
        return expansionSetCodeForImage;
    }

    @Override
    public int getZoneChangeCounter(Game game) {
        return 1; // Emblems can't move zones until now so return always 1
    }

    @Override
    public void updateZoneChangeCounter(Game game, ZoneChangeEvent event) {
        throw new UnsupportedOperationException(&quot;Unsupported operation&quot;);
    }

    @Override
    public void setZoneChangeCounter(int value, Game game) {
        throw new UnsupportedOperationException(&quot;Unsupported operation&quot;);
    }

    @Override
    public boolean isAllCreatureTypes(Game game) {
        return false;
    }

    @Override
    public void setIsAllCreatureTypes(boolean value) {
    }

    @Override
    public void setIsAllCreatureTypes(Game game, boolean value) {
    }

    public void discardEffects() {
        for (Ability ability : abilites) {
            for (Effect effect : ability.getEffects()) {
                if (effect instanceof ContinuousEffect) {
                    ((ContinuousEffect) effect).discard();
                }
            }
        }
    }

    @Override
    public void removePTCDA() {
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalPreventionEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalPreventionEffect.html#L98">98</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalReplacementEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalReplacementEffect.html#L89">89</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public boolean apply(Game game, Ability source) {
        return false;
    }

    @Override
    public boolean checksEventType(GameEvent event, Game game) {
        return effect.checksEventType(event, game)
                || (otherwiseEffect != null &amp;&amp; otherwiseEffect.checksEventType(event, game));
    }

    @Override
    public boolean applies(GameEvent event, Ability source, Game game) {
        if (!initDone) { // if simpleStaticAbility, init won't be called
            init(source, game);
        }
        conditionState = condition.apply(game, source);
        if (conditionState) {
            effect.setTargetPointer(this.targetPointer);
            return effect.applies(event, source, game);
        } else if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            return otherwiseEffect.applies(event, source, game);
        }
        return false;
    }

    @Override
    public String getText(Mode mode) {
        if ((staticText == null || staticText.isEmpty()) &amp;&amp; this.effect != null) { // usefull for conditional night/day card abilities</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\BecomesColorAllEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BecomesColorAllEffect.html#L79">79</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\BecomesColorSourceEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BecomesColorSourceEffect.html#L70">70</a></td></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\BecomesColorTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BecomesColorTargetEffect.html#L77">77</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>}

    @Override
    public void init(Ability source, Game game) {
        Player controller = game.getPlayer(source.getControllerId());
        if (controller == null) {
            return;
        }
        if (setColor == null) {
            ChoiceColor choice = new ChoiceColor();
            if (!controller.choose(Outcome.PutManaInPool, choice, game)) {
                discard();
                return;
            }
            setColor = choice.getColor();
            if (!game.isSimulation()) {
                game.informPlayers(controller.getLogName() + &quot; has chosen the color: &quot; + setColor.toString());
            }
        }

        super.init(source, game); //To change body of generated methods, choose Tools | Templates.
    }

    @Override
    public boolean apply(Game game, Ability source) {
        Player controller = game.getPlayer(source.getControllerId());
        if (controller == null) {
            return false;
        }
        if (setColor != null) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\dynamicvalue\common\CardTypesInGraveyardCount.java</td>
<td><a href="./xref/mage/abilities/dynamicvalue/common/CardTypesInGraveyardCount.html#L53">53</a></td></tr>
<tr class="a">
<td>mage\abilities\hint\common\CardTypesInGraveyardHint.java</td>
<td><a href="./xref/mage/abilities/hint/common/CardTypesInGraveyardHint.html#L51">51</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    private final Stream&lt;Card&gt; getStream(Game game, Ability ability) {
        Collection&lt;UUID&gt; playerIds;
        switch (this) {
            case YOU:
                Player player = game.getPlayer(ability.getControllerId());
                return player == null
                        ? null : player
                        .getGraveyard()
                        .getCards(game)
                        .stream();
            case OPPONENTS:
                playerIds = game.getOpponents(ability.getControllerId());
                break;
            case ALL:
                playerIds = game.getState().getPlayersInRange(ability.getControllerId(), game);
                break;
            default:
                return null;
        }
        return playerIds.stream()
                .map(game::getPlayer)
                .filter(Objects::nonNull)
                .map(Player::getGraveyard)
                .map(graveyard -&gt; graveyard.getCards(game))
                .flatMap(Collection::stream);
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\permanent\PermanentImpl.java</td>
<td><a href="./xref/mage/game/permanent/PermanentImpl.html#L1004">1004</a></td></tr>
<tr class="a">
<td>mage\players\PlayerImpl.java</td>
<td><a href="./xref/mage/players/PlayerImpl.html#L2142">2142</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>attacker = game.getPermanentOrLKIBattlefield(attackerId);
        if (attacker == null) {
            StackObject stackObject = game.getStack().getStackObject(attackerId);
            if (stackObject != null) {
                attacker = stackObject.getStackAbility().getSourceObject(game);
            } else {
                attacker = game.getObject(attackerId);
            }
            if (attacker instanceof Spell) {
                sourceAbilities = ((Spell) attacker).getAbilities(game);
                sourceControllerId = ((Spell) attacker).getControllerId();
            } else if (attacker instanceof Card) {
                sourceAbilities = ((Card) attacker).getAbilities(game);
                sourceControllerId = ((Card) attacker).getOwnerId();
            } else if (attacker instanceof CommandObject) {
                sourceControllerId = ((CommandObject) attacker).getControllerId();
                sourceAbilities = attacker.getAbilities();
            } else {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\keyword\FlashbackAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/FlashbackAbility.html#L200">200</a></td></tr>
<tr class="a">
<td>mage\abilities\keyword\JumpStartAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/JumpStartAbility.html#L102">102</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return new FlashbackReplacementEffect(this);
    }

    @Override
    public boolean apply(Game game, Ability source) {
        return true;
    }

    @Override
    public boolean replaceEvent(GameEvent event, Ability source, Game game) {
        Player controller = game.getPlayer(source.getControllerId());
        if (controller != null) {
            Card card = game.getCard(event.getTargetId());
            if (card != null) {
                discard();
                return controller.moveCards(
                        card, Zone.EXILED, source, game, false, false, false, event.getAppliedEffects());
            }
        }
        return false;
    }

    @Override
    public boolean checksEventType(GameEvent event, Game game) {
        return event.getType() == GameEvent.EventType.ZONE_CHANGE;
    }

    @Override
    public boolean applies(GameEvent event, Ability source, Game game) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalContinuousEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalContinuousEffect.html#L67">67</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalPreventionEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalPreventionEffect.html#L54">54</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>this.baseCondition = effect.baseCondition;
        this.initDone = effect.initDone;
    }

    @Override
    public boolean isDiscarded() {
        return this.discarded || effect.isDiscarded() || (otherwiseEffect != null &amp;&amp; otherwiseEffect.isDiscarded());
    }

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        if (baseCondition instanceof LockedInCondition) {
            condition = new FixedCondition(((LockedInCondition) baseCondition).getBaseCondition().apply(game, source));
        } else {
            condition = baseCondition;
        }
        effect.setTargetPointer(this.targetPointer);
        effect.init(source, game);
        if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            otherwiseEffect.init(source, game);
        }
        initDone = true;
    }

    @Override
    public boolean apply(Layer layer, SubLayer sublayer, Ability source, Game game) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\BoostEnchantedEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BoostEnchantedEffect.html#L65">65</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\GainAbilityWithAttachmentEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainAbilityWithAttachmentEffect.html#L64">64</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (affectedObjectsSet) {
            // Added boosts of activated or triggered abilities exist independent from the source they are created by
            // so a continuous effect for the permanent itself with the attachment is created
            Permanent equipment = game.getPermanentOrLKIBattlefield(source.getSourceId());
            if (equipment != null &amp;&amp; equipment.getAttachedTo() != null) {
                this.setTargetPointer(new FixedTarget(equipment.getAttachedTo(), game.getState().getZoneChangeCounter(equipment.getAttachedTo())));
            }
        }
    }

    @Override
    public boolean apply(Game game, Ability source) {
        Permanent permanent = null;
        if (affectedObjectsSet) {
            permanent = game.getPermanent(targetPointer.getFirst(game, source));
            if (permanent == null) {
                discard();
                return true;
            }
        } else {
            Permanent equipment = game.getPermanent(source.getSourceId());
            if (equipment != null &amp;&amp; equipment.getAttachedTo() != null) {
                permanent = game.getPermanent(equipment.getAttachedTo());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\search\SearchLibraryPutInHandEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/search/SearchLibraryPutInHandEffect.html#L76">76</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\search\SearchLibraryPutInHandOrOnBattlefieldEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/search/SearchLibraryPutInHandOrOnBattlefieldEffect.html#L89">89</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (revealCards) {
                    String name = &quot;Reveal&quot;;
                    Card sourceCard = game.getCard(source.getSourceId());
                    if (sourceCard != null) {
                        name = sourceCard.getIdName();
                    }
                    controller.revealCards(name, cards, game);
                }
            }
            controller.shuffleLibrary(source, game);
            return true;
        }
        if (forceShuffle) {
            controller.shuffleLibrary(source, game);
        }
        return false;
    }

    private void setText() {
        StringBuilder sb = new StringBuilder();
        sb.append(rulePrefix);
        if (target.getNumberOfTargets() == 0 &amp;&amp; target.getMaxNumberOfTargets() &gt; 0) {
            sb.append(&quot;up to &quot;).append(CardUtil.numberToText(target.getMaxNumberOfTargets())).append(' ');
            sb.append(target.getTargetName());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\Dungeon.java</td>
<td><a href="./xref/mage/game/command/Dungeon.html#L335">335</a></td></tr>
<tr class="a">
<td>mage\game\command\Emblem.java</td>
<td><a href="./xref/mage/game/command/Emblem.html#L251">251</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>this.expansionSetCodeForImage = expansionSetCodeForImage;
    }

    @Override
    public int getZoneChangeCounter(Game game) {
        return 1;
    }

    @Override
    public void updateZoneChangeCounter(Game game, ZoneChangeEvent event) {
        throw new UnsupportedOperationException(&quot;Unsupported operation&quot;);
    }

    @Override
    public void setZoneChangeCounter(int value, Game game) {
        throw new UnsupportedOperationException(&quot;Unsupported operation&quot;);
    }

    @Override
    public boolean isAllCreatureTypes(Game game) {
        return false;
    }

    @Override
    public void setIsAllCreatureTypes(boolean value) {
    }

    @Override
    public void setIsAllCreatureTypes(Game game, boolean value) {
    }

    public void discardEffects() {
        for (Ability ability : abilites) {
            for (Effect effect : ability.getEffects()) {
                if (effect instanceof ContinuousEffect) {
                    ((ContinuousEffect) effect).discard();
                }
            }
        }
    }

    @Override
    public void removePTCDA() {
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\Dungeon.java</td>
<td><a href="./xref/mage/game/command/Dungeon.html#L335">335</a></td></tr>
<tr class="a">
<td>mage\game\command\Plane.java</td>
<td><a href="./xref/mage/game/command/Plane.html#L250">250</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>this.expansionSetCodeForImage = expansionSetCodeForImage;
    }

    @Override
    public int getZoneChangeCounter(Game game) {
        return 1;
    }

    @Override
    public void updateZoneChangeCounter(Game game, ZoneChangeEvent event) {
        throw new UnsupportedOperationException(&quot;Unsupported operation&quot;);
    }

    @Override
    public void setZoneChangeCounter(int value, Game game) {
        throw new UnsupportedOperationException(&quot;Unsupported operation&quot;);
    }

    @Override
    public boolean isAllCreatureTypes(Game game) {
        return false;
    }

    @Override
    public void setIsAllCreatureTypes(boolean value) {
    }

    @Override
    public void setIsAllCreatureTypes(Game game, boolean value) {
    }

    public void discardEffects() {
        for (Ability ability : abilites) {
            for (Effect effect : ability.getEffects()) {
                if (effect instanceof ContinuousEffect) {
                    ((ContinuousEffect) effect).discard();
                }
            }
        }
    }

    @Override
    public void removePTCDA() {
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\GainControlAndUntapTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainControlAndUntapTargetEffect.html#L140">140</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\GainControlTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainControlTargetEffect.html#L137">137</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

        Target target = mode.getTargets().get(0);
        StringBuilder sb = new StringBuilder(&quot;gain control of &quot;);
        if (target.getMaxNumberOfTargets() &gt; 1) {
            if (target.getNumberOfTargets() &lt; target.getMaxNumberOfTargets()) {
                sb.append(&quot;up to &quot;);
            }
            sb.append(CardUtil.numberToText(target.getMaxNumberOfTargets())).append(&quot; target &quot;);
        } else if (!target.getTargetName().startsWith(&quot;another&quot;)) {
            sb.append(&quot;target &quot;);
        }
        sb.append(mode.getTargets().get(0).getTargetName());
        if (!duration.toString().isEmpty()) {
            sb.append(' ').append(duration.toString());
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\cards\decks\exporter\MtgArenaDeckExporter.java</td>
<td><a href="./xref/mage/cards/decks/exporter/MtgArenaDeckExporter.html#L21">21</a></td></tr>
<tr class="a">
<td>mage\cards\decks\exporter\MtgOnlineDeckExporter.java</td>
<td><a href="./xref/mage/cards/decks/exporter/MtgOnlineDeckExporter.html#L18">18</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>private static final Map&lt;String, String&gt; SET_CODE_REPLACEMENTS = ImmutableMap.of(&quot;DOM&quot;, &quot;DAR&quot;);

    @Override
    public void writeDeck(PrintWriter out, DeckCardLists deck) {
        Map&lt;String, Integer&gt; amount = new HashMap&lt;&gt;();
        List&lt;String&gt; deckMain = prepareCardsList(deck.getCards(), amount, &quot;M@&quot;);
        List&lt;String&gt; deckSideboard = prepareCardsList(deck.getSideboard(), amount, &quot;S@&quot;);

        printCards(out, deckMain, amount, &quot;M@&quot;);
        if (deckSideboard.size() &gt; 0) {
            out.println();
            printCards(out, deckSideboard, amount, &quot;S@&quot;);
        }
    }

    private List&lt;String&gt; prepareCardsList(List&lt;DeckCardInfo&gt; sourceCards, Map&lt;String, Integer&gt; amount, String prefix) {
        List&lt;String&gt; res = new ArrayList&lt;&gt;();
        for (DeckCardInfo card : sourceCards) {
            String setCode = card.getSetCode().toUpperCase(Locale.ENGLISH);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\LoseAbilityOrAnotherAbilityTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/LoseAbilityOrAnotherAbilityTargetEffect.html#L73">73</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\LoseAbilityTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/LoseAbilityTargetEffect.html#L47">47</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}
        return true;
    }

    @Override
    public String getText(Mode mode) {
        if (staticText != null &amp;&amp; !staticText.isEmpty()) {
            return staticText;
        }
        StringBuilder sb = new StringBuilder();
        Target target = mode.getTargets().get(0);
        if (target.getNumberOfTargets() &gt; 1) {
            if (target.getNumberOfTargets() &lt; target.getMaxNumberOfTargets()) {
                sb.append(&quot;Up to&quot;);
            }
            sb.append(target.getMaxNumberOfTargets()).append(&quot; target &quot;).append(target.getTargetName()).append(&quot; loses &quot;);
        } else {
            sb.append(&quot;Target &quot;).append(target.getTargetName()).append(&quot; loses &quot;);
        }
        sb.append(ability.getRule());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\DontUntapInControllersNextUntapStepTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/DontUntapInControllersNextUntapStepTargetEffect.html#L70">70</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\DontUntapInPlayersNextUntapStepAllEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/DontUntapInPlayersNextUntapStepAllEffect.html#L47">47</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return new DontUntapInControllersNextUntapStepTargetEffect(this);
    }

    @Override
    public boolean apply(Game game, Ability source) {
        return false;
    }

    @Override
    public String getInfoMessage(Ability source, GameEvent event, Game game) {
        MageObject mageObject = game.getObject(source);
        Permanent permanentToUntap = game.getPermanent((event.getTargetId()));
        if (permanentToUntap != null &amp;&amp; mageObject != null) {
            return permanentToUntap.getLogName() + &quot; doesn't untap (&quot; + mageObject.getLogName() + ')';
        }
        return null;
    }

    @Override
    public boolean checksEventType(GameEvent event, Game game) {
        return event.getType() == GameEvent.EventType.UNTAP_STEP || event.getType() == GameEvent.EventType.UNTAP;
    }

    @Override
    public boolean applies(GameEvent event, Ability source, Game game) {
        // the check if a permanent untap phase is already handled is needed if multiple effects are added to prevent untap in next untap step of controller
        // if we don't check it for every untap step of a turn only one effect would be consumed instead of all be valid for the next untap step
        if (event.getType() == GameEvent.EventType.UNTAP_STEP) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\cards\decks\exporter\MtgArenaDeckExporter.java</td>
<td><a href="./xref/mage/cards/decks/exporter/MtgArenaDeckExporter.html#L45">45</a></td></tr>
<tr class="a">
<td>mage\cards\decks\exporter\MtgOnlineDeckExporter.java</td>
<td><a href="./xref/mage/cards/decks/exporter/MtgOnlineDeckExporter.html#L39">39</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>res.add(name);
            }
            amount.put(code, curAmount + card.getQuantity());
        }
        return res;
    }

    private void printCards(PrintWriter out, List&lt;String&gt; deck, Map&lt;String, Integer&gt; amount, String prefix) {
        if (deck.size() == 0) return;

        boolean firstCard = true;
        for (String name : deck) {
            if (!firstCard) out.println();
            out.print(amount.get(prefix + name));
            out.print(' ');
            out.print(name);
            firstCard = false;
        }
        out.println();
    }

    @Override
    public FileFilter getFileFilter() {
        return fileFilter;
    }

    @Override
    public String getDescription() {
        return description;
    }

    @Override
    public String getDefaultFileExt() {
        return ext;
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\Emblem.java</td>
<td><a href="./xref/mage/game/command/Emblem.html#L89">89</a></td></tr>
<tr class="a">
<td>mage\game\command\Plane.java</td>
<td><a href="./xref/mage/game/command/Plane.html#L80">80</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}
        }
    }

    @Override
    public MageObject getSourceObject() {
        return sourceObject;
    }

    @Override
    public UUID getSourceId() {
        if (sourceObject != null) {
            return sourceObject.getId();
        }
        return null;
    }

    @Override
    public UUID getControllerId() {
        return this.controllerId;
    }

    public void setControllerId(UUID controllerId) {
        this.controllerId = controllerId;
        this.abilites.setControllerId(controllerId);
    }

    @Override
    public void setCopy(boolean isCopy, MageObject copyFrom) {
        this.copy = isCopy;
        this.copyFrom = (copyFrom != null ? copyFrom.copy() : null);
    }

    @Override
    public boolean isCopy() {
        return this.copy;
    }

    @Override
    public MageObject getCopyFrom() {
        return this.copyFrom;
    }

    @Override
    public String getName() {
        return name;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\keyword\RiotAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/RiotAbility.html#L49">49</a></td></tr>
<tr class="a">
<td>mage\abilities\keyword\UnleashAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/UnleashAbility.html#L52">52</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>private RiotReplacementEffect(final RiotReplacementEffect effect) {
        super(effect);
    }

    @Override
    public boolean checksEventType(GameEvent event, Game game) {
        return event.getType() == GameEvent.EventType.ENTERS_THE_BATTLEFIELD;
    }

    @Override
    public boolean applies(GameEvent event, Ability source, Game game) {
        return event.getTargetId().equals(source.getSourceId());
    }

    @Override
    public boolean apply(Game game, Ability source) {
        return false;
    }

    @Override
    public boolean replaceEvent(GameEvent event, Ability source, Game game) {
        Permanent creature = ((EntersTheBattlefieldEvent) event).getTarget();
        Player controller = game.getPlayer(source.getControllerId());
        if (creature != null &amp;&amp; controller != null) {
            if (controller.chooseUse(outcome, &quot;Have &quot; + creature.getLogName() + &quot; enter the battlefield with a +1/+1 counter on it or with haste?&quot;, null, &quot;+1/+1 counter&quot;, &quot;Haste&quot;, source, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L119">119</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetCreatureOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetCreatureOrPlayer.html#L117">117</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (permanent.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(permanent, sourceControllerId, source, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }

        return false;
    }

    /**
     * Checks if there are enough {@link Permanent} or {@link Player} that can
     * be selected. Should not be used for Ability targets since this does not
     * check for protection, shroud etc.
     *
     * @param sourceControllerId - controller of the select event
     * @param game
     * @return - true if enough valid {@link Permanent} or {@link Player} exist
     */
    @Override
    public boolean canChoose(UUID sourceControllerId, Game game) {
        int count = 0;

        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {
            Player player = game.getPlayer(playerId);
            if (filter.match(player, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }

        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\permanent\PermanentImpl.java</td>
<td><a href="./xref/mage/game/permanent/PermanentImpl.html#L1215">1215</a></td></tr>
<tr class="a">
<td>mage\players\PlayerImpl.java</td>
<td><a href="./xref/mage/players/PlayerImpl.html#L639">639</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (game.getPlayer(this.getControllerId()).hasOpponent(sourceControllerId, game)
                    &amp;&amp; null == game.getContinuousEffects().asThough(this.getId(), AsThoughEffectType.HEXPROOF, null, sourceControllerId, game)
                    &amp;&amp; abilities.stream()
                    .filter(HexproofBaseAbility.class::isInstance)
                    .map(HexproofBaseAbility.class::cast)
                    .anyMatch(ability -&gt; ability.checkObject(source, game))) {
                return false;
            }

            if (hasProtectionFrom(source, game)) {
                return false;
            }

            // example: Fiendslayer Paladin tried to target with Ultimate Price
            return !game.getContinuousEffects().preventedByRuleModification(
                    new TargetEvent(this, source.getId(), sourceControllerId),
                    null,
                    game,
                    true
            );
        }

        return true;
    }

    @Override
    public boolean hasProtectionFrom(MageObject source, Game game) {
        for (ProtectionAbility ability : this.getAbilities(game).getProtectionAbilities()) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\players\PlayerImpl.java</td>
<td><a href="./xref/mage/players/PlayerImpl.html#L3607">3607</a></td></tr>
<tr class="a">
<td>mage\players\PlayerImpl.java</td>
<td><a href="./xref/mage/players/PlayerImpl.html#L3672">3672</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (cost instanceof ManaCost) {
                                        manaCosts.add((ManaCost) cost);
                                    }
                                }
                            }

                            if (manaCosts.isEmpty()) {
                                return true;
                            } else {
                                if (availableMana == null) {
                                    return true;
                                }

                                // alternative cost reduce
                                copyAbility = ability.copy();
                                copyAbility.getManaCostsToPay().clear();
                                copyAbility.getManaCostsToPay().addAll(manaCosts.copy());
                                copyAbility.adjustCosts(game);
                                game.getContinuousEffects().costModification(copyAbility, game);

                                // reduced all cost
                                if (copyAbility.getManaCostsToPay().isEmpty()) {
                                    return true;
                                }

                                for (Mana mana : copyAbility.getManaCostsToPay().getOptions()) {
                                    if (availableMana.enough(mana)) {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                }
            }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\BoostAllEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BoostAllEffect.html#L112">112</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\BoostControlledEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BoostControlledEffect.html#L102">102</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>power = StaticValue.get(power.calculate(game, source, this));
            toughness = StaticValue.get(toughness.calculate(game, source, this));
        }
    }

    @Override
    public boolean apply(Game game, Ability source) {
        if (this.affectedObjectsSet) {
            for (Iterator&lt;MageObjectReference&gt; it = affectedObjectList.iterator(); it.hasNext(); ) { // filter may not be used again, because object can have changed filter relevant attributes but still geets boost
                Permanent permanent = it.next().getPermanent(game);
                if (permanent != null) {
                    permanent.addPower(power.calculate(game, source, this));
                    permanent.addToughness(toughness.calculate(game, source, this));
                } else {
                    it.remove(); // no longer on the battlefield, remove reference to object
                }
            }
        } else {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L111">111</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetPermanentOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetPermanentOrPlayer.html#L129">129</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (player != null &amp;&amp; player.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(player, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }

        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (permanent.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(permanent, sourceControllerId, source, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }

        return false;
    }

    /**
     * Checks if there are enough {@link Permanent} or {@link Player} that can
     * be selected. Should not be used for Ability targets since this does not
     * check for protection, shroud etc.
     *
     * @param sourceControllerId - controller of the select event
     * @param game
     * @return - true if enough valid {@link Permanent} or {@link Player} exist
     */
    @Override
    public boolean canChoose(UUID sourceControllerId, Game game) {
        int count = 0;

        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {
            Player player = game.getPlayer(playerId);
            if (filter.match(player, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L202">202</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetCreatureOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetCreatureOrPlayer.html#L191">191</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (filter.getPermanentFilter().match(permanent, sourceControllerId, null, game)) {
                possibleTargets.add(permanent.getId());
            }
        }

        return possibleTargets;
    }

    @Override
    public String getTargetedName(Game game) {
        StringBuilder sb = new StringBuilder();
        for (UUID targetId : getTargets()) {
            Permanent permanent = game.getPermanent(targetId);
            if (permanent != null) {
                sb.append(permanent.getLogName()).append(' ');
            } else {
                Player player = game.getPlayer(targetId);
                if (player != null) {
                    sb.append(player.getLogName()).append(' ');
                }
            }
        }
        return sb.toString().trim();
    }

    @Override
    public TargetAnyTarget copy() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\common\DrawCardTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/DrawCardTriggeredAbility.html#L51">51</a></td></tr>
<tr class="a">
<td>mage\abilities\common\DrawSecondCardTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/DrawSecondCardTriggeredAbility.html#L47">47</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public boolean checkEventType(GameEvent event, Game game) {
        return event.getType() == GameEvent.EventType.DREW_CARD;
    }

    @Override
    public boolean checkTrigger(GameEvent event, Game game) {
        switch (targetController) {
            case YOU:
                if (!isControlledBy(event.getPlayerId())) {
                    return false;
                }
                break;
            case ACTIVE:
                if (!game.isActivePlayer(event.getPlayerId())) {
                    return false;
                }
                break;
            case OPPONENT:
                Player controller = game.getPlayer(controllerId);
                if (controller == null || !controller.hasOpponent(event.getPlayerId(), game)) {
                    return false;
                }
                break;
            default:
                throw new IllegalArgumentException(&quot;TargetController &quot; + targetController + &quot; not supported&quot;);
        }
        return drawCardWatcher.checkEvent(event.getPlayerId(), event, cardNumber);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\condition\common\CastFromEverywhereSourceCondition.java</td>
<td><a href="./xref/mage/abilities/condition/common/CastFromEverywhereSourceCondition.html#L14">14</a></td></tr>
<tr class="a">
<td>mage\abilities\condition\common\CastFromHandSourcePermanentCondition.java</td>
<td><a href="./xref/mage/abilities/condition/common/CastFromHandSourcePermanentCondition.html#L16">16</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>public enum CastFromEverywhereSourceCondition implements Condition {

    instance;

    @Override
    public boolean apply(Game game, Ability source) {
        Permanent permanent = game.getPermanentEntering(source.getSourceId());
        int zccDiff = 0;
        if (permanent == null) {
            permanent = game.getPermanentOrLKIBattlefield(source.getSourceId()); // can be alredy again removed from battlefield so also check LKI
            zccDiff = -1;
        }
        if (permanent != null) {
            // check that the spell is still in the LKI
            Spell spell = game.getStack().getSpell(source.getSourceId());
            if (spell == null || spell.getZoneChangeCounter(game) != permanent.getZoneChangeCounter(game) + zccDiff) {
                if (game.getLastKnownInformation(source.getSourceId(), Zone.STACK, permanent.getZoneChangeCounter(game) + zccDiff) == null) {
                    return false;
                }
            }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\GainControlAndUntapTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainControlAndUntapTargetEffect.html#L72">72</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\GainControlTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainControlTargetEffect.html#L72">72</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return new GainControlAndUntapTargetEffect(this);
    }

    @Override
    public void init(Ability source, Game game) {
        if (this.controllingPlayerId == null &amp;&amp; fixedControl) {
            this.controllingPlayerId = source.getControllerId();
        }
        super.init(source, game);
    }

    @Override
    public boolean apply(Game game, Ability source) {
        Player controller = game.getPlayer(source.getControllerId());
        if (controller == null) {
            discard(); // controller no longer exists
            return false;
        }
        boolean oneTargetStillExists = false;
        for (UUID permanentId : getTargetPointer().getTargets(game, source)) {
            Permanent permanent = game.getPermanent(permanentId);
            if (permanent == null) {
                continue;
            }
            oneTargetStillExists = true;
            if (permanent.isControlledBy(controllingPlayerId)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\watchers\common\PermanentsEnteredBattlefieldWatcher.java</td>
<td><a href="./xref/mage/watchers/common/PermanentsEnteredBattlefieldWatcher.html#L26">26</a></td></tr>
<tr class="a">
<td>mage\watchers\common\PermanentsEnteredBattlefieldYourLastTurnWatcher.java</td>
<td><a href="./xref/mage/watchers/common/PermanentsEnteredBattlefieldYourLastTurnWatcher.html#L28">28</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (event.getType() == GameEvent.EventType.ENTERS_THE_BATTLEFIELD) {
            Permanent perm = game.getPermanentEntering(event.getTargetId());
            if (perm == null) {
                perm = game.getPermanent(event.getTargetId());
            }
            if (perm != null) {
                List&lt;Permanent&gt; permanents;
                if (!enteringBattlefield.containsKey(perm.getControllerId())) {
                    permanents = new ArrayList&lt;&gt;();
                    enteringBattlefield.put(perm.getControllerId(), permanents);
                } else {
                    permanents = enteringBattlefield.get(perm.getControllerId());
                }
                permanents.add(perm.copy()); // copy needed because attributes like color could be changed later
            }
        }
    }

    @Override
    public void reset() {
        super.reset();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L181">181</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetPermanentOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetPermanentOrPlayer.html#L191">191</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (permanent.canBeTargetedBy(targetSource, sourceControllerId, game)
                    &amp;&amp; filter.match(permanent, sourceControllerId, source, game)) {
                possibleTargets.add(permanent.getId());
            }
        }

        return possibleTargets;
    }

    @Override
    public Set&lt;UUID&gt; possibleTargets(UUID sourceControllerId, Game game) {
        Set&lt;UUID&gt; possibleTargets = new HashSet&lt;&gt;();

        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {
            Player player = game.getPlayer(playerId);
            if (filter.match(player, game)) {
                possibleTargets.add(playerId);
            }
        }

        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (filter.getPermanentFilter().match(permanent, sourceControllerId, null, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\condition\common\SourceHasCounterCondition.java</td>
<td><a href="./xref/mage/abilities/condition/common/SourceHasCounterCondition.html#L43">43</a></td></tr>
<tr class="a">
<td>mage\abilities\condition\common\TargetHasCounterCondition.java</td>
<td><a href="./xref/mage/abilities/condition/common/TargetHasCounterCondition.html#L43">43</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>card = game.getCard(source.getSourceId());
            if (card == null) {
                return false;
            }
        }
        if (from != -1) { //range compare
            int count;
            if (card != null) {
                count = card.getCounters(game).getCount(counterType);
            } else {
                count = permanent.getCounters(game).getCount(counterType);
            }
            if (to == Integer.MAX_VALUE) {
                return count &gt;= from;
            }
            return count &gt;= from &amp;&amp; count &lt;= to;
        } else // single compare (lte)
        {
            if (card != null) {
                return card.getCounters(game).getCount(counterType) &gt;= amount;
            } else {
                return permanent.getCounters(game).getCount(counterType) &gt;= amount;
            }
        }
    }

    @Override
    public String toString() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\DoUnlessAnyPlayerPaysEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/DoUnlessAnyPlayerPaysEffect.html#L70">70</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\DoUnlessTargetPlayerOrTargetsControllerPaysEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/DoUnlessTargetPlayerOrTargetsControllerPaysEffect.html#L80">80</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (cost != null) {
                costToPay = cost.copy();
                costValueMessage = costToPay.getText();
            } else {
                costToPay = ManaUtil.createManaCost(genericMana, game, source, this);
                costValueMessage = &quot;{&quot; + genericMana.calculate(game, source, this) + &quot;}&quot;;
            }
            String message;
            if (chooseUseText == null) {
                String effectText = executingEffects.getText(source.getModes().getMode());
                message = &quot;Pay &quot; + costValueMessage + &quot; to prevent (&quot; + effectText.substring(0, effectText.length() - 1) + &quot;)?&quot;;
            } else {
                message = chooseUseText;
            }
            message = CardUtil.replaceSourceName(message, sourceObject.getName());

            boolean result = true;
            boolean doEffect = true;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\TargetCard.java</td>
<td><a href="./xref/mage/target/TargetCard.html#L116">116</a></td></tr>
<tr class="a">
<td>mage\target\TargetCard.java</td>
<td><a href="./xref/mage/target/TargetCard.html#L191">191</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}
                            }
                        }
                        break;
                    case COMMAND:
                        List&lt;Card&gt; possibleCards = game.getCommandersIds(player, CommanderCardType.ANY, false).stream()
                                .map(game::getCard)
                                .filter(Objects::nonNull)
                                .filter(card -&gt; game.getState().getZone(card.getId()).equals(Zone.COMMAND))
                                .filter(card -&gt; filter.match(card, sourceControllerId, source, game))
                                .collect(Collectors.toList());
                        for (Card card : possibleCards) {
                            if (sourceId == null || isNotTarget() || !game.replaceEvent(new TargetEvent(card, sourceId, sourceControllerId))) {
                                possibleTargets++;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\common\BeginningOfDrawTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/BeginningOfDrawTriggeredAbility.html#L47">47</a></td></tr>
<tr class="a">
<td>mage\abilities\common\BeginningOfEndStepTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/BeginningOfEndStepTriggeredAbility.html#L47">47</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public boolean checkTrigger(GameEvent event, Game game) {
        switch (targetController) {
            case YOU:
                boolean yours = event.getPlayerId().equals(this.controllerId);
                if (yours &amp;&amp; getTargets().isEmpty()) {
                    this.getEffects().setTargetPointer(new FixedTarget(event.getPlayerId()));
                }
                return yours;
            case OPPONENT:
                if (game.getPlayer(this.controllerId).hasOpponent(event.getPlayerId(), game)) {
                    if (getTargets().isEmpty()) {
                        this.getEffects().setTargetPointer(new FixedTarget(event.getPlayerId()));
                    }
                    return true;
                }
                break;
            case NOT_YOU:</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\BecomesFaceDownCreatureAllEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BecomesFaceDownCreatureAllEffect.html#L79">79</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\BecomesFaceDownCreatureEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BecomesFaceDownCreatureEffect.html#L139">139</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>permanent.getManaCost().clear();
                        break;
                    case ColorChangingEffects_5:
                        permanent.getColor(game).setColor(new ObjectColor());
                        break;
                    case AbilityAddingRemovingEffects_6:
                        Card card = game.getCard(permanent.getId()); //
                        List&lt;Ability&gt; abilitiesToRemove = new ArrayList&lt;&gt;();
                        for (Ability ability : permanent.getAbilities()) {

                            // keep gained abilities from other sources, removes only own (card text)
                            if (card != null &amp;&amp; !card.getAbilities().contains(ability)) {
                                continue;
                            }

                            // 701.33c
                            // If a card with morph is manifested, its controller may turn that card face up using
                            // either the procedure described in rule 702.36e to turn a face-down permanent with morph face up
                            // or the procedure described above to turn a manifested permanent face up.
                            //
                            // so keep all tune face up abilities and other face down compatible
                            if (ability.getWorksFaceDown()) {
                                ability.setRuleVisible(false);
                                continue;
                            }

                            if (!ability.getRuleVisible() &amp;&amp; !ability.getEffects().isEmpty()) {
                                if (ability.getEffects().get(0) instanceof BecomesFaceDownCreatureAllEffect) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\players\PlayerImpl.java</td>
<td><a href="./xref/mage/players/PlayerImpl.html#L279">279</a></td></tr>
<tr class="a">
<td>mage\players\PlayerImpl.java</td>
<td><a href="./xref/mage/players/PlayerImpl.html#L365">365</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>this.castSourceIdWithAlternateMana.addAll(player.getCastSourceIdWithAlternateMana());
        for (Entry&lt;UUID, ManaCosts&lt;ManaCost&gt;&gt; entry : player.getCastSourceIdManaCosts().entrySet()) {
            this.castSourceIdManaCosts.put(entry.getKey(), (entry.getValue() == null ? null : entry.getValue().copy()));
        }
        for (Entry&lt;UUID, Costs&lt;Cost&gt;&gt; entry : player.getCastSourceIdCosts().entrySet()) {
            this.castSourceIdCosts.put(entry.getKey(), (entry.getValue() == null ? null : entry.getValue().copy()));
        }
        this.payManaMode = player.payManaMode;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetPermanentOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetPermanentOrPlayer.html#L162">162</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetSpellOrPermanent.java</td>
<td><a href="./xref/mage/target/common/TargetSpellOrPermanent.html#L161">161</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (player != null &amp;&amp; filter.getPlayerFilter().match(player, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }
        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (filter.match(permanent, sourceControllerId, null, game) &amp;&amp; filter.match(permanent, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }
        return false;
    }

    @Override
    public Set&lt;UUID&gt; possibleTargets(UUID sourceControllerId, Ability source, Game game) {
        Set&lt;UUID&gt; possibleTargets = new HashSet&lt;&gt;();
        MageObject targetSource = game.getObject(source);
        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\Dungeon.java</td>
<td><a href="./xref/mage/game/command/Dungeon.html#L199">199</a></td></tr>
<tr class="a">
<td>mage\game\command\Emblem.java</td>
<td><a href="./xref/mage/game/command/Emblem.html#L114">114</a></td></tr>
<tr class="b">
<td>mage\game\stack\StackAbility.java</td>
<td><a href="./xref/mage/game/stack/StackAbility.html#L114">114</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>}

    @Override
    public void setCopy(boolean isCopy, MageObject copyFrom) {
        this.copy = isCopy;
        this.copyFrom = (copyFrom != null ? copyFrom.copy() : null);
    }

    @Override
    public boolean isCopy() {
        return this.copy;
    }

    @Override
    public MageObject getCopyFrom() {
        return this.copyFrom;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public String getIdName() {
        return getName() + &quot; [&quot; + getId().toString().substring(0, 3) + ']';
    }

    @Override
    public String getLogName() {
        return GameLog.getColoredObjectIdName(this);
    }

    @Override
    public String getImageName() {
        return this.name;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L154">154</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetCreatureOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetCreatureOrPlayer.html#L149">149</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (filter.match(permanent, sourceControllerId, null, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }

        return false;
    }

    @Override
    public Set&lt;UUID&gt; possibleTargets(UUID sourceControllerId, Ability source, Game game) {
        Set&lt;UUID&gt; possibleTargets = new HashSet&lt;&gt;();
        MageObject targetSource = game.getObject(source);

        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {
            Player player = game.getPlayer(playerId);
            if (player != null
                    &amp;&amp; player.canBeTargetedBy(targetSource, sourceControllerId, game)
                    &amp;&amp; filter.match(player, sourceControllerId, source, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\AstralArenaPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AstralArenaPlane.html#L47">47</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\HedronFieldsOfAgadeemPlane.java</td>
<td><a href="./xref/mage/game/command/planes/HedronFieldsOfAgadeemPlane.html#L40">40</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TheEonFogPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TheEonFogPlane.html#L38">38</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>Effect chaosEffect = new DamageAllEffect(2, new FilterCreaturePermanent());
        Target chaosTarget = null;

        List&lt;Effect&gt; chaosEffects = new ArrayList&lt;Effect&gt;();
        chaosEffects.add(chaosEffect);
        List&lt;Target&gt; chaosTargets = new ArrayList&lt;Target&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}

class AstralArenaAttackRestrictionEffect extends RestrictionEffect {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\common\EntersBattlefieldOrDiesSourceTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/EntersBattlefieldOrDiesSourceTriggeredAbility.html#L36">36</a></td></tr>
<tr class="a">
<td>mage\abilities\common\EntersBattlefieldOrLeavesSourceTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/EntersBattlefieldOrLeavesSourceTriggeredAbility.html#L29">29</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return new EntersBattlefieldOrDiesSourceTriggeredAbility(this);
    }

    @Override
    public boolean checkEventType(GameEvent event, Game game) {
        return event.getType() == GameEvent.EventType.ENTERS_THE_BATTLEFIELD
                || event.getType() == GameEvent.EventType.ZONE_CHANGE;
    }

    @Override
    public boolean checkTrigger(GameEvent event, Game game) {
        if (event.getType() == GameEvent.EventType.ENTERS_THE_BATTLEFIELD
                &amp;&amp; event.getTargetId().equals(getSourceId())) {
            return true;
        }
        if (event.getType() == GameEvent.EventType.ZONE_CHANGE &amp;&amp; event.getTargetId().equals(this.getSourceId())) {
            ZoneChangeEvent zEvent = (ZoneChangeEvent) event;
            if (zEvent.isDiesEvent()) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\ReturnFromGraveyardToBattlefieldTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/ReturnFromGraveyardToBattlefieldTargetEffect.html#L86">86</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\TransformTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/TransformTargetEffect.html#L49">49</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>Target target = mode.getTargets().get(0);
            if (target.getMaxNumberOfTargets() == Integer.MAX_VALUE
                    &amp;&amp; target.getMinNumberOfTargets() == 0) {
                sb.append(&quot;any number of &quot;);
            } else {
                if (target.getMaxNumberOfTargets() != target.getNumberOfTargets()) {
                    sb.append(&quot;up to &quot;);
                }
                sb.append(CardUtil.numberToText(target.getMaxNumberOfTargets())).append(' ');
            }
            String targetName = mode.getTargets().get(0).getTargetName();
            if (!targetName.contains(&quot;target &quot;)) {
                sb.append(&quot;target &quot;);
            }
            sb.append(targetName);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\AcademyAtTolariaWestPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AcademyAtTolariaWestPlane.html#L45">45</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\AstralArenaPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AstralArenaPlane.html#L47">47</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\EdgeOfMalacolPlane.java</td>
<td><a href="./xref/mage/game/command/planes/EdgeOfMalacolPlane.html#L46">46</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\HedronFieldsOfAgadeemPlane.java</td>
<td><a href="./xref/mage/game/command/planes/HedronFieldsOfAgadeemPlane.html#L40">40</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TheEonFogPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TheEonFogPlane.html#L38">38</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\TrailOfTheMageRingsPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TrailOfTheMageRingsPlane.html#L53">53</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\UndercityReachesPlane.java</td>
<td><a href="./xref/mage/game/command/planes/UndercityReachesPlane.html#L52">52</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>Effect chaosEffect = new DiscardHandControllerEffect();
        Target chaosTarget = null;

        List&lt;Effect&gt; chaosEffects = new ArrayList&lt;Effect&gt;();
        chaosEffects.add(chaosEffect);

        List&lt;Target&gt; chaosTargets = new ArrayList&lt;Target&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}

class DrawCardsActivePlayerEffect extends OneShotEffect {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\common\TapForManaAllTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/TapForManaAllTriggeredAbility.html#L50">50</a></td></tr>
<tr class="a">
<td>mage\abilities\common\TapForManaAllTriggeredManaAbility.java</td>
<td><a href="./xref/mage/abilities/common/TapForManaAllTriggeredManaAbility.html#L44">44</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>TappedForManaEvent manaEvent = ((TappedForManaEvent) event);
        Permanent permanent = manaEvent.getPermanent();
        if (permanent == null || !filter.match(permanent, getControllerId(), this, game)) {
            return false;
        }
        getEffects().setValue(&quot;mana&quot;, manaEvent.getMana());
        getEffects().setValue(&quot;tappedPermanent&quot;, permanent);
        switch (setTargetPointer) {
            case PERMANENT:
                getEffects().setTargetPointer(new FixedTarget(permanent.getId(), permanent.getZoneChangeCounter(game)));
                break;
            case PLAYER:
                getEffects().setTargetPointer(new FixedTarget(permanent.getControllerId()));
                break;
        }
        return true;
    }

    @Override
    public TapForManaAllTriggeredAbility copy() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\AcademyAtTolariaWestPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AcademyAtTolariaWestPlane.html#L45">45</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\AstralArenaPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AstralArenaPlane.html#L47">47</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\EdgeOfMalacolPlane.java</td>
<td><a href="./xref/mage/game/command/planes/EdgeOfMalacolPlane.html#L46">46</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\HedronFieldsOfAgadeemPlane.java</td>
<td><a href="./xref/mage/game/command/planes/HedronFieldsOfAgadeemPlane.html#L40">40</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TheDarkBaronyPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TheDarkBaronyPlane.html#L50">50</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\TheEonFogPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TheEonFogPlane.html#L38">38</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TrailOfTheMageRingsPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TrailOfTheMageRingsPlane.html#L53">53</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\TrugaJunglePlane.java</td>
<td><a href="./xref/mage/game/command/planes/TrugaJunglePlane.html#L47">47</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\UndercityReachesPlane.java</td>
<td><a href="./xref/mage/game/command/planes/UndercityReachesPlane.html#L52">52</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>Effect chaosEffect = new DiscardHandControllerEffect();
        Target chaosTarget = null;

        List&lt;Effect&gt; chaosEffects = new ArrayList&lt;Effect&gt;();
        chaosEffects.add(chaosEffect);

        List&lt;Target&gt; chaosTargets = new ArrayList&lt;Target&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\mana\DynamicManaEffect.java</td>
<td><a href="./xref/mage/abilities/effects/mana/DynamicManaEffect.html#L99">99</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\mana\DynamicManaEffect.java</td>
<td><a href="./xref/mage/abilities/effects/mana/DynamicManaEffect.html#L132">132</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (baseMana.getBlack() &gt; 0) {
            computedMana.setBlack(count);
        } else if (baseMana.getBlue() &gt; 0) {
            computedMana.setBlue(count);
        } else if (baseMana.getGreen() &gt; 0) {
            computedMana.setGreen(count);
        } else if (baseMana.getRed() &gt; 0) {
            computedMana.setRed(count);
        } else if (baseMana.getWhite() &gt; 0) {
            computedMana.setWhite(count);
        } else if (baseMana.getColorless() &gt; 0) {
            computedMana.setColorless(count);
        } else if (baseMana.getAny() &gt; 0) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\AgyremPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AgyremPlane.html#L59">59</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\FieldsOfSummerPlane.java</td>
<td><a href="./xref/mage/game/command/planes/FieldsOfSummerPlane.html#L43">43</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\PanopticonPlane.java</td>
<td><a href="./xref/mage/game/command/planes/PanopticonPlane.html#L50">50</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\TazeemPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TazeemPlane.html#L46">46</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TurriIslandPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TurriIslandPlane.html#L41">41</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>Effect chaosEffect = new AgyremRestrictionEffect();
        Target chaosTarget = null;

        List&lt;Effect&gt; chaosEffects = new ArrayList&lt;&gt;();
        chaosEffects.add(chaosEffect);
        List&lt;Target&gt; chaosTargets = new ArrayList&lt;&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}

class AgyremEffect extends OneShotEffect {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalContinuousEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalContinuousEffect.html#L73">73</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalReplacementEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalReplacementEffect.html#L53">53</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return this.discarded || effect.isDiscarded() || (otherwiseEffect != null &amp;&amp; otherwiseEffect.isDiscarded());
    }

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        if (baseCondition instanceof LockedInCondition) {
            condition = new FixedCondition(((LockedInCondition) baseCondition).getBaseCondition().apply(game, source));
        } else {
            condition = baseCondition;
        }
        effect.setTargetPointer(this.targetPointer);
        effect.init(source, game);
        if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            otherwiseEffect.init(source, game);
        }
        initDone = true;
    }

    @Override
    public boolean apply(Layer layer, SubLayer sublayer, Ability source, Game game) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\combat\CantAttackIfDefenderControlsPermanent.java</td>
<td><a href="./xref/mage/abilities/effects/common/combat/CantAttackIfDefenderControlsPermanent.html#L27">27</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\combat\CantAttackUnlessDefenderControllsPermanent.java</td>
<td><a href="./xref/mage/abilities/effects/common/combat/CantAttackUnlessDefenderControllsPermanent.html#L27">27</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>public CantAttackIfDefenderControlsPermanent(final CantAttackIfDefenderControlsPermanent effect) {
        super(effect);
        this.filter = effect.filter;
    }

    @Override
    public boolean applies(Permanent permanent, Ability source, Game game) {
        return permanent.getId().equals(source.getSourceId());
    }

    @Override
    public boolean canAttack(Permanent attacker, UUID defenderId, Ability source, Game game, boolean canUseChooseDialogs) {
        if (defenderId == null) {
            return true;
        }

        UUID defendingPlayerId;
        Player player = game.getPlayer(defenderId);
        if (player == null) {
            Permanent permanent = game.getPermanent(defenderId);
            if (permanent != null) {
                defendingPlayerId = permanent.getControllerId();
            } else {
                return true;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\BecomesCreatureTypeTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BecomesCreatureTypeTargetEffect.html#L57">57</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\BecomesSubtypeAllEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BecomesSubtypeAllEffect.html#L56">56</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (permanent == null) {
                continue;
            }
            flag = true;
            if (loseOther) {
                permanent.removeAllCreatureTypes(game);
            }
            for (SubType subtype : subtypes) {
                permanent.addSubType(game, subtype);
            }
        }
        if (!flag &amp;&amp; duration == Duration.Custom) {
            discard();
        }
        return true;
    }

    private String setText() {
        StringBuilder sb = new StringBuilder();
        sb.append(&quot;Target creature becomes that type&quot;);
        if (!duration.toString().isEmpty() &amp;&amp; duration != Duration.EndOfGame) {
            sb.append(' ').append(duration.toString());
        }
        return sb.toString();
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\draft\RichManBoosterDraft.java</td>
<td><a href="./xref/mage/game/draft/RichManBoosterDraft.html#L22">22</a></td></tr>
<tr class="a">
<td>mage\game\draft\RichManCubeBoosterDraft.java</td>
<td><a href="./xref/mage/game/draft/RichManCubeBoosterDraft.html#L20">20</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>public RichManBoosterDraft(DraftOptions options, List&lt;ExpansionSet&gt; sets) {
        super(options, sets);
    }

    @Override
    public void start() {
        cardNum = 1;
        boosterNum = 1;
        while (!isAbort() &amp;&amp; cardNum &lt;= 36) {
            openBooster();
            cardNum = 1;
            fireUpdatePlayersEvent();
            while (!isAbort() &amp;&amp; pickCards()) {
                // new booster each time, so order is irrelevant
                passBoosterToLeft();
                fireUpdatePlayersEvent();
            }
            boosterNum++;
        }
        this.fireEndDraftEvent();
    }

    @Override
    protected void passBoosterToLeft() {
        synchronized (players) {
            UUID startId = table.get(0);
            UUID currentId = startId;
            UUID nextId = table.getNext();
            DraftPlayer next = players.get(nextId);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\AkoumPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AkoumPlane.html#L48">48</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\LetheLakePlane.java</td>
<td><a href="./xref/mage/game/command/planes/LetheLakePlane.html#L40">40</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TheZephyrMazePlane.java</td>
<td><a href="./xref/mage/game/command/planes/TheZephyrMazePlane.html#L66">66</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>Target chaosTarget = new TargetCreaturePermanent(filter);

        List&lt;Effect&gt; chaosEffects = new ArrayList&lt;Effect&gt;();
        chaosEffects.add(chaosEffect);
        List&lt;Target&gt; chaosTargets = new ArrayList&lt;Target&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\FeedingGroundsPlane.java</td>
<td><a href="./xref/mage/game/command/planes/FeedingGroundsPlane.html#L51">51</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\NayaPlane.java</td>
<td><a href="./xref/mage/game/command/planes/NayaPlane.html#L54">54</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>Target chaosTarget = new TargetCreaturePermanent(1, 1, StaticFilters.FILTER_PERMANENT_A_CREATURE, false);

        List&lt;Effect&gt; chaosEffects = new ArrayList&lt;&gt;();
        chaosEffects.add(chaosEffect);
        List&lt;Target&gt; chaosTargets = new ArrayList&lt;&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\mulligan\LondonMulligan.java</td>
<td><a href="./xref/mage/game/mulligan/LondonMulligan.html#L82">82</a></td></tr>
<tr class="a">
<td>mage\game\mulligan\ParisMulligan.java</td>
<td><a href="./xref/mage/game/mulligan/ParisMulligan.html#L38">38</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>int numCards = startingHandSizes.get(player.getId());
        player.getLibrary().addAll(player.getHand().getCards(game), game);
        player.getHand().clear();
        player.shuffleLibrary(null, game);
        int deduction = 1;
        if (freeMulligans &gt; 0) {
            if (usedFreeMulligans.containsKey(player.getId())) {
                int used = usedFreeMulligans.get(player.getId());
                if (used &lt; freeMulligans) {
                    deduction = 0;
                    usedFreeMulligans.put(player.getId(), used + 1);
                }
            } else {
                deduction = 0;
                usedFreeMulligans.put(player.getId(), 1);
            }
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalContinuousRuleModifyingEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalContinuousRuleModifyingEffect.html#L44">44</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalRequirementEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalRequirementEffect.html#L55">55</a></td></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalRestrictionEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalRestrictionEffect.html#L54">54</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>this.baseCondition = effect.baseCondition;
        this.initDone = effect.initDone;
    }

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        if (baseCondition instanceof LockedInCondition) {
            condition = new FixedCondition(((LockedInCondition) baseCondition).getBaseCondition().apply(game, source));
        } else {
            condition = baseCondition;
        }
        effect.setTargetPointer(this.targetPointer);
        effect.init(source, game);
        if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            otherwiseEffect.init(source, game);
        }
        initDone = true;
    }

    @Override
    public boolean isDiscarded() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalInterveningIfTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalInterveningIfTriggeredAbility.html#L85">85</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalTriggeredAbility.html#L74">74</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public Effects getEffects() {
        return ability.getEffects();
    }

    @Override
    public void addEffect(Effect effect) {
        ability.addEffect(effect);
    }

    @Override
    public Modes getModes() {
        return ability.getModes();
    }

    @Override
    public List&lt;Watcher&gt; getWatchers() {
        return ability.getWatchers();
    }

    @Override
    public void addWatcher(Watcher watcher) {
        ability.addWatcher(watcher);
    }

    @Override
    public Effects getEffects(Game game, EffectType effectType) {
        return ability.getEffects(game, effectType);
    }

    @Override
    public boolean isOptional() {
        return ability.isOptional();
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\PreventNextDamageFromChosenSourceToTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/PreventNextDamageFromChosenSourceToTargetEffect.html#L46">46</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\PreventNextDamageFromChosenSourceToYouEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/PreventNextDamageFromChosenSourceToYouEffect.html#L45">45</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return new PreventNextDamageFromChosenSourceToTargetEffect(this);
    }

    @Override
    public void init(Ability source, Game game) {
        this.targetSource.choose(Outcome.PreventDamage, source.getControllerId(), source.getSourceId(), source, game);
    }

    @Override
    public boolean replaceEvent(GameEvent event, Ability source, Game game) {
        preventDamageAction(event, source, game);
        this.used = true;
        return false;
    }

    @Override
    public boolean applies(GameEvent event, Ability source, Game game) {
        if (!this.used &amp;&amp; super.applies(event, source, game)) {
            if (event.getTargetId().equals(targetPointer.getFirst(game, source)) &amp;&amp; event.getSourceId().equals(targetSource.getFirstTarget())) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\cards\decks\importer\DecDeckImporter.java</td>
<td><a href="./xref/mage/cards/decks/importer/DecDeckImporter.html#L37">37</a></td></tr>
<tr class="a">
<td>mage\cards\decks\importer\MWSDeckImporter.java</td>
<td><a href="./xref/mage/cards/decks/importer/MWSDeckImporter.html#L56">56</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>for (int i = 0; i &lt; num; i++) {
                    if (!sideboard) {
                        deckList.getCards().add(new DeckCardInfo(cardInfo.getName(), cardInfo.getCardNumber(), cardInfo.getSetCode()));
                    } else {
                        deckList.getSideboard().add(new DeckCardInfo(cardInfo.getName(), cardInfo.getCardNumber(), cardInfo.getSetCode()));
                    }
                }
            }
        } catch (NumberFormatException nfe) {
            sbMessage.append(&quot;Invalid number: &quot;).append(lineNum).append(&quot; at line &quot;).append(lineCount).append('\n');
        }
    }

}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\AcademyAtTolariaWestPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AcademyAtTolariaWestPlane.html#L48">48</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\AkoumPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AkoumPlane.html#L50">50</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\AstralArenaPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AstralArenaPlane.html#L50">50</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\EdgeOfMalacolPlane.java</td>
<td><a href="./xref/mage/game/command/planes/EdgeOfMalacolPlane.html#L49">49</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\HedronFieldsOfAgadeemPlane.java</td>
<td><a href="./xref/mage/game/command/planes/HedronFieldsOfAgadeemPlane.html#L43">43</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\LetheLakePlane.java</td>
<td><a href="./xref/mage/game/command/planes/LetheLakePlane.html#L42">42</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TheDarkBaronyPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TheDarkBaronyPlane.html#L53">53</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\TheEonFogPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TheEonFogPlane.html#L41">41</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TheZephyrMazePlane.java</td>
<td><a href="./xref/mage/game/command/planes/TheZephyrMazePlane.html#L68">68</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\TrailOfTheMageRingsPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TrailOfTheMageRingsPlane.html#L56">56</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TrugaJunglePlane.java</td>
<td><a href="./xref/mage/game/command/planes/TrugaJunglePlane.html#L50">50</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\UndercityReachesPlane.java</td>
<td><a href="./xref/mage/game/command/planes/UndercityReachesPlane.html#L55">55</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>List&lt;Effect&gt; chaosEffects = new ArrayList&lt;Effect&gt;();
        chaosEffects.add(chaosEffect);

        List&lt;Target&gt; chaosTargets = new ArrayList&lt;Target&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\keyword\EnlistAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/EnlistAbility.html#L68">68</a></td></tr>
<tr class="a">
<td>mage\abilities\keyword\ExertAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/ExertAbility.html#L88">88</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public boolean checksEventType(GameEvent event, Game game) {
        return event.getType() == GameEvent.EventType.ATTACKER_DECLARED;
    }

    @Override
    public boolean applies(GameEvent event, Ability source, Game game) {
        return event.getSourceId().equals(source.getSourceId());
    }

    @Override
    public boolean apply(Game game, Ability source) {
        return false;
    }

    @Override
    public boolean replaceEvent(GameEvent event, Ability source, Game game) {
        Permanent creature = game.getPermanent(event.getSourceId());
        Player controller = game.getPlayer(source.getControllerId());
        if (creature == null || controller == null</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\AgyremPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AgyremPlane.html#L62">62</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\FeedingGroundsPlane.java</td>
<td><a href="./xref/mage/game/command/planes/FeedingGroundsPlane.html#L53">53</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\FieldsOfSummerPlane.java</td>
<td><a href="./xref/mage/game/command/planes/FieldsOfSummerPlane.html#L46">46</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\PanopticonPlane.java</td>
<td><a href="./xref/mage/game/command/planes/PanopticonPlane.html#L53">53</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TazeemPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TazeemPlane.html#L49">49</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\TurriIslandPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TurriIslandPlane.html#L44">44</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>List&lt;Effect&gt; chaosEffects = new ArrayList&lt;&gt;();
        chaosEffects.add(chaosEffect);
        List&lt;Target&gt; chaosTargets = new ArrayList&lt;&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}

class AgyremEffect extends OneShotEffect {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetCardInCommandZone.java</td>
<td><a href="./xref/mage/target/common/TargetCardInCommandZone.html#L42">42</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetCardInHand.java</td>
<td><a href="./xref/mage/target/common/TargetCardInHand.html#L49">49</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>&amp;&amp; game.getState().getPlayersInRange(getTargetController() == null ? playerId : getTargetController(), game).contains(game.getOwnerId(id))
                &amp;&amp; filter.match(card, game);
    }

    @Override
    public boolean canTarget(UUID id, Ability source, Game game) {
        return this.canTarget(source.getControllerId(), id, source, game);
    }

    @Override
    public Set&lt;UUID&gt; possibleTargets(UUID sourceControllerId, Ability source, Game game) {
        Set&lt;UUID&gt; possibleTargets = new HashSet&lt;&gt;();
        Player player = game.getPlayer(sourceControllerId);
        if (player == null) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetPermanentOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetPermanentOrPlayer.html#L204">204</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetSpellOrPermanent.java</td>
<td><a href="./xref/mage/target/common/TargetSpellOrPermanent.html#L206">206</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>possibleTargets.add(playerId);
            }
        }
        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (filter.match(permanent, sourceControllerId, null, game)) {
                possibleTargets.add(permanent.getId());
            }
        }
        return possibleTargets;
    }

    @Override
    public String getTargetedName(Game game) {
        StringBuilder sb = new StringBuilder();
        for (UUID targetId : getTargets()) {
            Permanent permanent = game.getPermanent(targetId);
            if (permanent != null) {
                sb.append(permanent.getLogName()).append(' ');
            } else {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\planes\AgyremPlane.java</td>
<td><a href="./xref/mage/game/command/planes/AgyremPlane.html#L62">62</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\FieldsOfSummerPlane.java</td>
<td><a href="./xref/mage/game/command/planes/FieldsOfSummerPlane.html#L46">46</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\NayaPlane.java</td>
<td><a href="./xref/mage/game/command/planes/NayaPlane.html#L56">56</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\PanopticonPlane.java</td>
<td><a href="./xref/mage/game/command/planes/PanopticonPlane.html#L53">53</a></td></tr>
<tr class="b">
<td>mage\game\command\planes\TazeemPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TazeemPlane.html#L49">49</a></td></tr>
<tr class="a">
<td>mage\game\command\planes\TurriIslandPlane.java</td>
<td><a href="./xref/mage/game/command/planes/TurriIslandPlane.html#L44">44</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>List&lt;Effect&gt; chaosEffects = new ArrayList&lt;&gt;();
        chaosEffects.add(chaosEffect);
        List&lt;Target&gt; chaosTargets = new ArrayList&lt;&gt;();
        chaosTargets.add(chaosTarget);

        ActivateIfConditionActivatedAbility chaosAbility = new ActivateIfConditionActivatedAbility(Zone.COMMAND, new RollPlanarDieEffect(chaosEffects, chaosTargets), new GenericManaCost(0), MainPhaseStackEmptyCondition.instance);
        chaosAbility.addWatcher(new PlanarRollWatcher());
        this.getAbilities().add(chaosAbility);
        chaosAbility.setMayActivate(TargetController.ANY);
        this.getAbilities().add(new SimpleStaticAbility(Zone.ALL, new PlanarDieRollCostIncreasingEffect(chaosAbility.getOriginalId())));
    }
}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\mana\AnyColorLandsProduceManaAbility.java</td>
<td><a href="./xref/mage/abilities/mana/AnyColorLandsProduceManaAbility.html#L114">114</a></td></tr>
<tr class="a">
<td>mage\abilities\mana\AnyColorPermanentTypesManaAbility.java</td>
<td><a href="./xref/mage/abilities/mana/AnyColorPermanentTypesManaAbility.html#L88">88</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>Choice choice = ManaType.getChoiceOfManaTypes(types, onlyColors);
        if (choice.getChoices().size() == 1) {
            choice.setChoice(choice.getChoices().iterator().next());
        } else {
            Player player = game.getPlayer(source.getControllerId());
            if (player == null || !player.choose(outcome, choice, game)) {
                return null;
            }
        }

        ManaType chosenType = ManaType.findByName(choice.getChoice());
        return chosenType == null ? null : new Mana(chosenType);
    }

    private Set&lt;ManaType&gt; getManaTypes(Game game, Ability source) {
        Set&lt;ManaType&gt; types = new HashSet&lt;&gt;(6);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L84">84</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetCreatureOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetCreatureOrPlayer.html#L84">84</a></td></tr>
<tr class="b">
<td>mage\target\common\TargetPermanentOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetPermanentOrPlayer.html#L102">102</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>return player.canBeTargetedBy(targetSource, source.getControllerId(), game) &amp;&amp; filter.match(player, game);
            }
        }

        if (permanent != null) {
            return filter.match(permanent, game);
        }
        return filter.match(player, game);
    }

    /**
     * Checks if there are enough {@link Permanent} or {@link Player} that can
     * be chosen. Should only be used for Ability targets since this checks for
     * protection, shroud etc.
     *
     * @param sourceControllerId - controller of the target event source
     * @param source
     * @param game
     * @return - true if enough valid {@link Permanent} or {@link Player} exist
     */
    @Override
    public boolean canChoose(UUID sourceControllerId, Ability source, Game game) {
        int count = 0;

        MageObject targetSource = game.getObject(source);
        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {
            Player player = game.getPlayer(playerId);
            if (player != null &amp;&amp; player.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(player, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\common\delayed\AtTheBeginOfNextCleanupDelayedTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/delayed/AtTheBeginOfNextCleanupDelayedTriggeredAbility.html#L36">36</a></td></tr>
<tr class="a">
<td>mage\abilities\common\delayed\AtTheBeginOfNextUpkeepDelayedTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/delayed/AtTheBeginOfNextUpkeepDelayedTriggeredAbility.html#L37">37</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public boolean checkTrigger(GameEvent event, Game game) {
        return true;
    }

    @Override
    public String getRule() {
        StringBuilder sb = new StringBuilder();
        String text = modes.getText();
        if (!text.isEmpty()) {
            sb.append(Character.toUpperCase(text.charAt(0)));
            if (text.endsWith(&quot;.&quot;)) {
                sb.append(text.substring(1, text.length()-1));
            } else {
                sb.append(text.substring(1));
            }
        }
        return sb.append(&quot; at the beginning of the next cleanup step.&quot;).toString();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetPermanentOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetPermanentOrPlayer.html#L129">129</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetSpellOrPermanent.java</td>
<td><a href="./xref/mage/target/common/TargetSpellOrPermanent.html#L127">127</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (player != null &amp;&amp; player.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(player, sourceControllerId, source, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }
        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (permanent.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(permanent, sourceControllerId, source, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }
        return false;
    }

    /**
     * Checks if there are enough {@link mage.game.permanent.Permanent} or
     * {@link mage.players.Player} that can be selected. Should not be used for
     * Ability targets since this does not check for protection, shroud etc.
     *
     * @param sourceControllerId - controller of the select event
     * @param game
     * @return - true if enough valid {@link mage.game.permanent.Permanent} or
     * {@link mage.players.Player} exist
     */
    @Override
    public boolean canChoose(UUID sourceControllerId, Game game) {
        int count = 0;
        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\cards\ModalDoubleFacesCard.java</td>
<td><a href="./xref/mage/cards/ModalDoubleFacesCard.html#L63">63</a></td></tr>
<tr class="a">
<td>mage\cards\SplitCard.java</td>
<td><a href="./xref/mage/cards/SplitCard.html#L59">59</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public void assignNewId() {
        super.assignNewId();
        leftHalfCard.assignNewId();
        rightHalfCard.assignNewId();
    }

    @Override
    public void setCopy(boolean isCopy, MageObject copiedFrom) {
        super.setCopy(isCopy, copiedFrom);
        leftHalfCard.setCopy(isCopy, copiedFrom);
        rightHalfCard.setCopy(isCopy, copiedFrom);
    }

    @Override
    public boolean moveToZone(Zone toZone, Ability source, Game game, boolean flag, List&lt;UUID&gt; appliedEffects) {
        if (super.moveToZone(toZone, source, game, flag, appliedEffects)) {
            game.getState().setZone(leftHalfCard.getId(), toZone);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\common\ExploitCreatureTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/ExploitCreatureTriggeredAbility.html#L49">49</a></td></tr>
<tr class="a">
<td>mage\abilities\common\GodEternalDiesTriggeredAbility.java</td>
<td><a href="./xref/mage/abilities/common/GodEternalDiesTriggeredAbility.html#L50">50</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public boolean isInUseableZone(Game game, MageObject source, GameEvent event) {
        Permanent sourcePermanent = null;
        if (game.getState().getZone(getSourceId()) == Zone.BATTLEFIELD) {
            sourcePermanent = game.getPermanent(getSourceId());
        } else {
            if (game.getShortLivingLKI(getSourceId(), Zone.BATTLEFIELD)) {
                sourcePermanent = (Permanent) game.getLastKnownInformation(getSourceId(), Zone.BATTLEFIELD);
            }
        }
        if (sourcePermanent == null) {
            return false;
        }
        return hasSourceObjectAbility(game, sourcePermanent, event);
    }

    @Override
    public boolean checkTrigger(GameEvent event, Game game) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\designations\Designation.java</td>
<td><a href="./xref/mage/designations/Designation.html#L76">76</a></td></tr>
<tr class="a">
<td>mage\game\command\Dungeon.java</td>
<td><a href="./xref/mage/game/command/Dungeon.html#L198">198</a></td></tr>
<tr class="b">
<td>mage\game\command\Emblem.java</td>
<td><a href="./xref/mage/game/command/Emblem.html#L113">113</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>this.id = UUID.randomUUID();
    }

    @Override
    public void setCopy(boolean isCopy, MageObject copyFrom) {
        this.copy = isCopy;
        this.copyFrom = (copyFrom != null ? copyFrom.copy() : null);
    }

    @Override
    public boolean isCopy() {
        return this.copy;
    }

    @Override
    public MageObject getCopyFrom() {
        return this.copyFrom;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public String getIdName() {
        return getName() + &quot; [&quot; + getId().toString().substring(0, 3) + ']';
    }

    @Override
    public String getImageName() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L111">111</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetSpellOrPermanent.java</td>
<td><a href="./xref/mage/target/common/TargetSpellOrPermanent.html#L127">127</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (player != null &amp;&amp; player.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(player, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }

        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (permanent.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(permanent, sourceControllerId, source, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }

        return false;
    }

    /**
     * Checks if there are enough {@link Permanent} or {@link Player} that can
     * be selected. Should not be used for Ability targets since this does not
     * check for protection, shroud etc.
     *
     * @param sourceControllerId - controller of the select event
     * @param game
     * @return - true if enough valid {@link Permanent} or {@link Player} exist
     */
    @Override
    public boolean canChoose(UUID sourceControllerId, Game game) {
        int count = 0;

        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\designations\Designation.java</td>
<td><a href="./xref/mage/designations/Designation.html#L77">77</a></td></tr>
<tr class="a">
<td>mage\game\stack\StackAbility.java</td>
<td><a href="./xref/mage/game/stack/StackAbility.html#L114">114</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public void setCopy(boolean isCopy, MageObject copyFrom) {
        this.copy = isCopy;
        this.copyFrom = (copyFrom != null ? copyFrom.copy() : null);
    }

    @Override
    public boolean isCopy() {
        return this.copy;
    }

    @Override
    public MageObject getCopyFrom() {
        return this.copyFrom;
    }

    @Override
    public String getName() {
        return name;
    }

    @Override
    public String getIdName() {
        return getName() + &quot; [&quot; + getId().toString().substring(0, 3) + ']';
    }

    @Override
    public String getImageName() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\counter\AddCountersAttachedEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/counter/AddCountersAttachedEffect.html#L37">37</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\counter\RemoveCountersAttachedEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/counter/RemoveCountersAttachedEffect.html#L37">37</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>public AddCountersAttachedEffect(final AddCountersAttachedEffect effect) {
        super(effect);
        if (effect.counter != null) {
            this.counter = effect.counter.copy();
        }
        this.amount = effect.amount;
    }

    @Override
    public boolean apply(Game game, Ability source) {
        Permanent permanent = game.getPermanent(source.getSourceId());
        if (permanent != null &amp;&amp; permanent.getAttachedTo() != null) {
            Permanent attachedTo = game.getPermanent(permanent.getAttachedTo());
            if (attachedTo != null &amp;&amp; counter != null) {
                Counter newCounter = counter.copy();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\DoUnlessAnyPlayerPaysEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/DoUnlessAnyPlayerPaysEffect.html#L102">102</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\DoUnlessControllerPaysEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/DoUnlessControllerPaysEffect.html#L73">73</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}
            }
            // do the effects if nobody paid
            if (doEffect) {
                for (Effect effect : executingEffects) {
                    effect.setTargetPointer(this.targetPointer);
                    if (effect instanceof OneShotEffect) {
                        result &amp;= effect.apply(game, source);
                    } else {
                        game.addEffect((ContinuousEffect) effect, source);
                    }
                }
            }
            return result;
        }
        return false;
    }

    protected Player getPayingPlayer(Game game, Ability source) {
        return game.getPlayer(source.getControllerId());
    }

    @Override
    public String getText(Mode mode) {
        if (!staticText.isEmpty()) {
            return staticText;
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\keyword\FlashbackAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/FlashbackAbility.html#L107">107</a></td></tr>
<tr class="a">
<td>mage\abilities\keyword\ForetellAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/ForetellAbility.html#L398">398</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>spellAbilityCopy = ((ModalDoubleFacesCard) card).getRightHalfCard().getSpellAbility().copy();
                    }
                } else {
                    spellAbilityCopy = card.getSpellAbility().copy();
                }
                if (spellAbilityCopy == null) {
                    return null;
                }
                spellAbilityCopy.setId(this.getId());
                spellAbilityCopy.getManaCosts().clear();
                spellAbilityCopy.getManaCostsToPay().clear();
                spellAbilityCopy.getCosts().addAll(this.getCosts().copy());
                spellAbilityCopy.addCost(this.getManaCosts().copy());
                spellAbilityCopy.setSpellAbilityCastMode(this.getSpellAbilityCastMode());
                spellAbilityToResolve = spellAbilityCopy;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\Dungeon.java</td>
<td><a href="./xref/mage/game/command/Dungeon.html#L188">188</a></td></tr>
<tr class="a">
<td>mage\game\command\Plane.java</td>
<td><a href="./xref/mage/game/command/Plane.html#L94">94</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return null;
    }

    @Override
    public UUID getControllerId() {
        return this.controllerId;
    }

    public void setControllerId(UUID controllerId) {
        this.controllerId = controllerId;
        this.abilites.setControllerId(controllerId);
    }

    @Override
    public void setCopy(boolean isCopy, MageObject copyFrom) {
        this.copy = isCopy;
        this.copyFrom = (copyFrom != null ? copyFrom.copy() : null);
    }

    @Override
    public boolean isCopy() {
        return this.copy;
    }

    @Override
    public MageObject getCopyFrom() {
        return this.copyFrom;
    }

    @Override
    public String getName() {
        return name;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\BoostAllEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BoostAllEffect.html#L100">100</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\GainAbilityAllEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainAbilityAllEffect.html#L66">66</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        setRuntimeData(source, game);
        if (this.affectedObjectsSet) {
            for (Permanent perm : game.getBattlefield().getActivePermanents(filter, source.getControllerId(), source, game)) {
                if (!(excludeSource &amp;&amp; perm.getId().equals(source.getSourceId())) &amp;&amp; selectedByRuntimeData(perm, source, game)) {
                    affectedObjectList.add(new MageObjectReference(perm, game));
                }
            }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalContinuousEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalContinuousEffect.html#L74">74</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalContinuousRuleModifyingEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalContinuousRuleModifyingEffect.html#L46">46</a></td></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalPreventionEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalPreventionEffect.html#L61">61</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalReplacementEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalReplacementEffect.html#L54">54</a></td></tr>
<tr class="b">
<td>mage\abilities\decorator\ConditionalRequirementEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalRequirementEffect.html#L57">57</a></td></tr>
<tr class="a">
<td>mage\abilities\decorator\ConditionalRestrictionEffect.java</td>
<td><a href="./xref/mage/abilities/decorator/ConditionalRestrictionEffect.html#L56">56</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        if (baseCondition instanceof LockedInCondition) {
            condition = new FixedCondition(((LockedInCondition) baseCondition).getBaseCondition().apply(game, source));
        } else {
            condition = baseCondition;
        }
        effect.setTargetPointer(this.targetPointer);
        effect.init(source, game);
        if (otherwiseEffect != null) {
            otherwiseEffect.setTargetPointer(this.targetPointer);
            otherwiseEffect.init(source, game);
        }
        initDone = true;
    }

    @Override
    public boolean apply(Layer layer, SubLayer sublayer, Ability source, Game game) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\combat\Combat.java</td>
<td><a href="./xref/mage/game/combat/Combat.html#L338">338</a></td></tr>
<tr class="a">
<td>mage\game\combat\Combat.java</td>
<td><a href="./xref/mage/game/combat/Combat.html#L372">372</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>for (Ability ab : bandsWithOther) {
                BandsWithOtherAbility ability = (BandsWithOtherAbility) ab;
                if (ability.getSubtype() != null) {
                    predicates.add(ability.getSubtype().getPredicate());
                }
                if (ability.getSupertype() != null) {
                    predicates.add(ability.getSupertype().getPredicate());
                }
                if (ability.getName() != null) {
                    predicates.add(new NamePredicate(ability.getName()));
                }
            }
            filter.add(Predicates.or(predicates));
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\command\emblems\WrennAndSixEmblem.java</td>
<td><a href="./xref/mage/game/command/emblems/WrennAndSixEmblem.html#L58">58</a></td></tr>
<tr class="a">
<td>mage\game\command\emblems\WrennAndSixEmblem.java</td>
<td><a href="./xref/mage/game/command/emblems/WrennAndSixEmblem.html#L74">74</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>SplitCardHalf rightHalfCard = ((SplitCard) card).getRightHalfCard();
                if (leftHalfCard.isInstantOrSorcery(game)) {
                    Ability ability = new RetraceAbility(leftHalfCard);
                    ability.setSourceId(cardId);
                    ability.setControllerId(leftHalfCard.getOwnerId());
                    game.getState().addOtherAbility(leftHalfCard, ability);
                }
                if (rightHalfCard.isInstantOrSorcery(game)) {
                    Ability ability = new RetraceAbility(rightHalfCard);
                    ability.setSourceId(cardId);
                    ability.setControllerId(rightHalfCard.getOwnerId());
                    game.getState().addOtherAbility(rightHalfCard, ability);
                }
            }
            if (card instanceof ModalDoubleFacesCard) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\BoostControlledEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/BoostControlledEffect.html#L88">88</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\GainAbilityControlledEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainAbilityControlledEffect.html#L64">64</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        if (this.affectedObjectsSet) {
            for (Permanent perm : game.getBattlefield().getActivePermanents(filter, source.getControllerId(), source, game)) {
                if (perm.isControlledBy(source.getControllerId())
                        &amp;&amp; !(excludeSource &amp;&amp; perm.getId().equals(source.getSourceId()))) {
                    affectedObjectList.add(new MageObjectReference(perm, game));
                }
            }
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\GainAbilityAttachedEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainAbilityAttachedEffect.html#L72">72</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\GainAbilityWithAttachmentEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainAbilityWithAttachmentEffect.html#L58">58</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return new GainAbilityAttachedEffect(this);
    }

    @Override
    public void init(Ability source, Game game) {
        super.init(source, game);
        if (affectedObjectsSet) {
            Permanent equipment = game.getPermanentOrLKIBattlefield(source.getSourceId());
            if (equipment != null &amp;&amp; equipment.getAttachedTo() != null) {
                this.setTargetPointer(new FixedTarget(equipment.getAttachedTo(), game.getState().getZoneChangeCounter(equipment.getAttachedTo())));
            }
        }
    }

    @Override
    public boolean apply(Game game, Ability source) {
        Permanent permanent;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\GameImpl.java</td>
<td><a href="./xref/mage/game/GameImpl.html#L2414">2414</a></td></tr>
<tr class="a">
<td>mage\game\GameImpl.java</td>
<td><a href="./xref/mage/game/GameImpl.html#L2426">2426</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>if (!((FilterPermanent) auraFilter).match(attachedTo, perm.getControllerId(), perm.getSpellAbility(), this)
                                            || attachedTo.cantBeAttachedBy(perm, null, this, true)) {
                                        Card card = this.getCard(perm.getId());
                                        if (card != null &amp;&amp; card.isCreature(this)) {
                                            UUID wasAttachedTo = perm.getAttachedTo();
                                            perm.attachTo(null, null, this);
                                            BestowAbility.becomeCreature(perm, this);
                                            fireEvent(new UnattachedEvent(wasAttachedTo, perm.getId(), perm, null));
                                        } else if (movePermanentToGraveyardWithInfo(perm)) {
                                            somethingHappened = true;
                                        }
                                    }
                                } else if (!auraFilter.match(attachedTo, this) || attachedTo.cantBeAttachedBy(perm, null, this, true)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L79">79</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetCreatureOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetCreatureOrPlayer.html#L79">79</a></td></tr>
<tr class="b">
<td>mage\target\common\TargetPermanentOrPlayerAmount.java</td>
<td><a href="./xref/mage/target/common/TargetPermanentOrPlayerAmount.html#L72">72</a></td></tr>
<tr class="a"><td colspan='2'>
<div>
<pre>MageObject targetSource = game.getObject(source);
            if (permanent != null) {
                return permanent.canBeTargetedBy(targetSource, source.getControllerId(), game) &amp;&amp; filter.match(permanent, source.getControllerId(), source, game);
            }
            if (player != null) {
                return player.canBeTargetedBy(targetSource, source.getControllerId(), game) &amp;&amp; filter.match(player, game);
            }
        }

        if (permanent != null) {
            return filter.match(permanent, game);
        }
        return filter.match(player, game);
    }

    /**
     * Checks if there are enough {@link Permanent} or {@link Player} that can
     * be chosen. Should only be used for Ability targets since this checks for
     * protection, shroud etc.
     *
     * @param sourceControllerId - controller of the target event source
     * @param source
     * @param game
     * @return - true if enough valid {@link Permanent} or {@link Player} exist
     */
    @Override
    public boolean canChoose(UUID sourceControllerId, Ability source, Game game) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\continuous\GainControlAndUntapTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainControlAndUntapTargetEffect.html#L110">110</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\continuous\GainControlTargetEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/continuous/GainControlTargetEffect.html#L107">107</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>controlChanged = true;
                }
            }
            if (source instanceof ActivatedAbility
                    &amp;&amp; firstControlChange &amp;&amp; !controlChanged) {
                // If it was not possible to get control of target permanent by the activated ability the first time it took place
                // the effect failed (e.g. because of Guardian Beast) and must be discarded
                // This does not handle correctly multiple targets at once
                discard();
            }
            if (condition != null &amp;&amp; !condition.apply(game, source)) {
                discard();
            }
        }
        // no valid target exists and the controller is no longer in the game, effect can be discarded
        if (!oneTargetStillExists || !controller.isInGame()) {
            discard();
        }
        firstControlChange = false;
        return true;
    }

    @Override
    public String getText(Mode mode) {
        if (!staticText.isEmpty()) {
            return staticText;
        }

        if (mode.getTargets().isEmpty()) {
            return &quot;gain control of target permanent until end of turn. Untap it.&quot;;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\keyword\FlashbackAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/FlashbackAbility.html#L150">150</a></td></tr>
<tr class="a">
<td>mage\abilities\keyword\ForetellAbility.java</td>
<td><a href="./xref/mage/abilities/keyword/ForetellAbility.html#L433">433</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>StringBuilder sbRule = new StringBuilder(&quot;Flashback&quot;);
        if (!costs.isEmpty()) {
            sbRule.append(&quot;&amp;mdash;&quot;);
        } else {
            sbRule.append(' ');
        }
        if (!manaCosts.isEmpty()) {
            sbRule.append(manaCosts.getText());
        }
        if (!costs.isEmpty()) {
            if (!manaCosts.isEmpty()) {
                sbRule.append(&quot;, &quot;);
            }
            sbRule.append(costs.getText());
            sbRule.append('.');
        }
        if (abilityName != null) {
            sbRule.append(&quot;. &quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetCreatureOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetCreatureOrPlayer.html#L117">117</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetPermanentOrPlayer.java</td>
<td><a href="./xref/mage/target/common/TargetPermanentOrPlayer.html#L136">136</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getCreatureFilter(), sourceControllerId, game)) {
            if (permanent.canBeTargetedBy(targetSource, sourceControllerId, game) &amp;&amp; filter.match(permanent, sourceControllerId, source, game)) {
                count++;
                if (count &gt;= this.minNumberOfTargets) {
                    return true;
                }
            }
        }
        return false;
    }

    /**
     * Checks if there are enough {@link Permanent} or {@link Player} that can
     * be selected. Should not be used for Ability targets since this does not
     * check for protection, shroud etc.
     *
     * @param sourceControllerId - controller of the select event
     * @param game
     * @return - true if enough valid {@link Permanent} or {@link Player} exist
     */
    @Override
    public boolean canChoose(UUID sourceControllerId, Game game) {
        int count = 0;
        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {
            Player player = game.getPlayer(playerId);
            if (filter.match(player, game)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\costs\common\CyclingDiscardCost.java</td>
<td><a href="./xref/mage/abilities/costs/common/CyclingDiscardCost.html#L26">26</a></td></tr>
<tr class="a">
<td>mage\abilities\costs\common\DiscardSourceCost.java</td>
<td><a href="./xref/mage/abilities/costs/common/DiscardSourceCost.html#L31">31</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>}

    @Override
    public boolean canPay(Ability ability, Ability source, UUID controllerId, Game game) {
        return game.getPlayer(controllerId).getHand().contains(source.getSourceId());
    }

    @Override
    public boolean pay(Ability ability, Game game, Ability source, UUID controllerId, boolean noMana, Cost costToPay) {
        Player player = game.getPlayer(controllerId);
        if (player != null) {
            Card card = player.getHand().get(source.getSourceId(), game);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\abilities\effects\common\DontUntapInControllersNextUntapStepSourceEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/DontUntapInControllersNextUntapStepSourceEffect.html#L40">40</a></td></tr>
<tr class="a">
<td>mage\abilities\effects\common\DontUntapInPlayersNextUntapStepAllEffect.java</td>
<td><a href="./xref/mage/abilities/effects/common/DontUntapInPlayersNextUntapStepAllEffect.html#L60">60</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>return &quot;{this} doesn't untap (&quot; + mageObject.getLogName() + ')';
        }
        return null;
    }

    @Override
    public boolean checksEventType(GameEvent event, Game game) {
        return event.getType() == GameEvent.EventType.UNTAP_STEP || event.getType() == GameEvent.EventType.UNTAP;
    }

    @Override
    public boolean applies(GameEvent event, Ability source, Game game) {
        // the check for turn number is needed if multiple effects are added to prevent untap in next untap step
        // if we don't check for turn number, every turn only one effect would be used instead of correctly consuming
        // all existing skip the next untap step effects.
        
        // Discard effect if related to a previous turn
        if (validForTurnNum &gt; 0 &amp;&amp; validForTurnNum &lt; game.getTurnNum()) {
            discard();
            return false;
        }
        // remember the turn of the untap step the effect has to be applied
        if (event.getType() == GameEvent.EventType.UNTAP_STEP</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\game\combat\CombatGroup.java</td>
<td><a href="./xref/mage/game/combat/CombatGroup.html#L308">308</a></td></tr>
<tr class="a">
<td>mage\game\combat\CombatGroup.java</td>
<td><a href="./xref/mage/game/combat/CombatGroup.html#L388">388</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>int damage = getDamageValueFromPermanent(attacker, game);
        if (canDamage(attacker, first)) {
            // must be set before attacker damage marking because of effects like Test of Faith
            Map&lt;UUID, Integer&gt; blockerPower = new HashMap&lt;&gt;();
            for (UUID blockerId : blockerOrder) {
                Permanent blocker = game.getPermanent(blockerId);
                if (canDamage(blocker, first)) {
                    if (checkSoleBlockerAfter(blocker, game)) { // blocking several creatures handled separately
                        blockerPower.put(blockerId, getDamageValueFromPermanent(blocker, game));
                    }
                }
            }
            Map&lt;UUID, Integer&gt; assigned = new HashMap&lt;&gt;();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Line</th></tr>
<tr class="b">
<td>mage\target\common\TargetAnyTarget.java</td>
<td><a href="./xref/mage/target/common/TargetAnyTarget.html#L176">176</a></td></tr>
<tr class="a">
<td>mage\target\common\TargetSpellOrPermanent.java</td>
<td><a href="./xref/mage/target/common/TargetSpellOrPermanent.html#L188">188</a></td></tr>
<tr class="b"><td colspan='2'>
<div>
<pre>possibleTargets.add(playerId);
            }
        }

        for (Permanent permanent : game.getBattlefield().getActivePermanents(filter.getPermanentFilter(), sourceControllerId, game)) {
            if (permanent.canBeTargetedBy(targetSource, sourceControllerId, game)
                    &amp;&amp; filter.match(permanent, sourceControllerId, source, game)) {
                possibleTargets.add(permanent.getId());
            }
        }

        return possibleTargets;
    }

    @Override
    public Set&lt;UUID&gt; possibleTargets(UUID sourceControllerId, Game game) {
        Set&lt;UUID&gt; possibleTargets = new HashSet&lt;&gt;();

        for (UUID playerId : game.getState().getPlayersInRange(sourceControllerId, game)) {</pre></div></td></tr></table></section>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2023..      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
